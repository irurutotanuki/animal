<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Ç¢„Éã„Éû„É´„Éª„ÇØ„É≠„Éã„ÇØ„É´</title>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animations */
        @keyframes shimmer {
            0% { transform: translateX(-150%) skewX(-15deg); }
            100% { transform: translateX(150%) skewX(-15deg); }
        }
        .animate-spin-slow {
            animation: spin 8s linear infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }
        @keyframes float-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }
        .animate-damage {
            animation: float-up 1s forwards ease-out;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Mobile Optimization */
        body { 
            -webkit-user-select: none; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Prevent pull-to-refresh */
        }
        
        /* Smooth Scrolling for iOS */
        .scroll-container {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        /* Safe area for mobile scrolling */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-950 text-white h-[100dvh] w-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICONS (Lucide) ---
        const IconBase = ({ children, className, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Icons = {
            Sparkles: (p) => <IconBase {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></IconBase>,
            Trophy: (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>,
            Skull: (p) => <IconBase {...p}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></IconBase>,
            Zap: (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>,
            Search: (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>,
            RotateCcw: (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>,
            Gift: (p) => <IconBase {...p}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></IconBase>,
            ShoppingBag: (p) => <IconBase {...p}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconBase>,
            Gavel: (p) => <IconBase {...p}><path d="m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10"/><path d="m16 16 6-6"/><path d="m8 8 6-6"/><path d="m9 7 8 8"/><path d="m21 11-8-8"/></IconBase>,
            Coins: (p) => <IconBase {...p}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m7.1 10 .9.26L9 10"/></IconBase>,
            Timer: (p) => <IconBase {...p}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></IconBase>,
            Calendar: (p) => <IconBase {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>,
            X: (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            Scissors: (p) => <IconBase {...p}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" x2="8.12" y1="4" y2="15.88"/><line x1="14.47" x2="20" y1="14.48" y2="20"/><line x1="8.12" x2="12" y1="8.12" y2="12"/></IconBase>,
            Swords: (p) => <IconBase {...p}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" x2="19" y1="19" y2="13"/><line x1="16" x2="20" y1="16" y2="20"/><line x1="19" x2="21" y1="21" y2="19"/></IconBase>,
            CheckCircle: (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>
        };

        // --- DATA ---

        const RARITY_CONFIG = {
            GOD: { color: 'from-indigo-900 via-purple-900 to-pink-900', border: 'border-yellow-400', text: 'text-yellow-300', probability: 0.005, powerBase: 9500, hpBase: 33000, cost: 10, sell: 5000, buy: 20000 },
            LEGEND: { color: 'from-yellow-700 to-yellow-900', border: 'border-yellow-500', text: 'text-yellow-400', probability: 0.025, powerBase: 8000, hpBase: 28000, cost: 8, sell: 2000, buy: 8000 },
            ULTIMATE: { color: 'from-red-800 to-red-950', border: 'border-red-500', text: 'text-red-400', probability: 0.07, powerBase: 6500, hpBase: 22000, cost: 6, sell: 800, buy: 3000 },
            EPIC: { color: 'from-purple-800 to-indigo-900', border: 'border-purple-400', text: 'text-purple-300', probability: 0.15, powerBase: 4500, hpBase: 15000, cost: 5, sell: 300, buy: 1200 },
            RARE: { color: 'from-blue-700 to-blue-900', border: 'border-blue-400', text: 'text-blue-300', probability: 0.30, powerBase: 2500, hpBase: 8500, cost: 3, sell: 100, buy: 400 },
            COMMON: { color: 'from-slate-600 to-slate-800', border: 'border-slate-400', text: 'text-slate-300', probability: 0.45, powerBase: 1000, hpBase: 3500, cost: 1, sell: 10, buy: 50 }
        };

        // Full Emoji Mapping
        const ANIMAL_EMOJIS = {
            "„É©„Ç§„Ç™„É≥": "ü¶Å", "„Éâ„É©„Ç¥„É≥": "üêâ", "„ÇØ„Ç∏„É©": "üêã", "„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ": "ü¶Ö", "„ÇØ„É©„Éº„Ç±„É≥": "ü¶ë",
            "„Ç∞„É™„Éï„Ç©„É≥": "ü¶Ö", "„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ": "ü¶ñ", "„Éû„É≥„É¢„Çπ": "ü¶£", "„Çµ„É©„Éû„É≥„ÉÄ„Éº": "ü¶é", "„Éö„Ç¨„Çµ„Çπ": "ü¶Ñ",
            "„Éí„Éâ„É©": "üêç", "Áãê": "ü¶ä", "„Çπ„Éï„Ç£„É≥„ÇØ„Çπ": "üóø", "„Ç¥„É™„É©": "ü¶ç", "„Çµ„É°": "ü¶à",
            "„Éö„É≥„ÇÆ„É≥": "üêß", "„Çµ„Ç§": "ü¶è", "„Ç´„Éû„Ç≠„É™": "ü¶ó", "„Çπ„Ç≥„Éº„Éî„Ç™„É≥": "ü¶Ç", "„Éè„É§„Éñ„Çµ": "ü¶Ö",
            "„Ç¢„Éä„Ç≥„É≥„ÉÄ": "üêç", "„Çø„Ç§„Ç¨„Éº": "üêØ", "„Éô„Ç¢": "üêª", "„ÇØ„É≠„Ç≥„ÉÄ„Ç§„É´": "üêä", "„Ç§„Éº„É´": "üêü",
            "„Éï„É≠„ÉÉ„Ç∞": "üê∏", "„Ç´„Éñ„Éà„É†„Ç∑": "ü™≤", "„Ç§„Éº„Ç∞„É´": "ü¶Ö", "„É†„Çµ„Çµ„Éì": "üêøÔ∏è", "„Ç´„É°„É¨„Ç™„É≥": "ü¶é",
            "„Ç¢„É´„Éû„Ç∏„É≠": "ü¶î", "„Ç≥„Ç¶„É¢„É™": "ü¶á", "„Ç™„Ç™„Ç´„Éü": "üê∫", "„Çæ„Ç¶": "üêò", "„ÉÅ„Éº„Çø„Éº": "üêÜ",
            "„Éí„Éß„Ç¶": "üêÜ", "„Ç∏„É£„Ç¨„Éº": "üêÜ", "„Ç´„Éê": "ü¶õ", "„Ç≠„É™„É≥": "ü¶í", "„Éê„ÉÉ„Éï„Ç°„É≠„Éº": "üêÉ",
            "„Ç§„Éé„Ç∑„Ç∑": "üêó", "„Ç´„É≥„Ç¨„É´„Éº": "ü¶ò", "„Éà„Ç´„Ç≤": "ü¶é", "„ÉØ„Éã": "üêä", "„Éò„Éì": "üêç",
            "„Ç≥„Éñ„É©": "üêç", "„ÉØ„Ç∑": "ü¶Ö", "„Ç≥„É≥„Éâ„É´": "ü¶Ö", "„Éï„ÇØ„É≠„Ç¶": "ü¶â", "„ÉÄ„ÉÅ„Éß„Ç¶": "üê¶",
            "„Ç∑„É£„ÉÅ": "üê¨", "„Ç§„Ç´": "ü¶ë", "„Ç®„Ç§": "üêü", "„Éî„É©„Éã„Ç¢": "üêü", "„Çπ„Ç∫„É°„Éê„ÉÅ": "üêù",
            "„ÇØ„ÉØ„Ç¨„Çø": "ü™≤", "„Éà„É≥„Éú": "ü™Å", "„ÇØ„É¢": "üï∑Ô∏è", "„É†„Ç´„Éá": "üêõ", "„Éë„É≥„ÉÄ": "üêº",
            "„Çµ„É´": "üêí", "„Ç™„É©„É≥„Ç¶„Éº„Çø„É≥": "ü¶ß", "„Éè„É†„Çπ„Çø„Éº": "üêπ", "„Éç„Ç∫„Éü": "üê≠", "„É™„Çπ": "üêøÔ∏è",
            "„Ç¶„Çµ„ÇÆ": "üê∞", "„Éç„Ç≥": "üê±", "„Ç§„Éå": "üê∂", "„Ç¶„Éû": "üê¥", "„Ç¶„Ç∑": "üêÆ", "„Éñ„Çø": "üê∑",
            "„Éí„ÉÑ„Ç∏": "üêë", "„É§„ÇÆ": "üêê", "„Éà„É™": "üêî", "„Éã„ÉØ„Éà„É™": "üêî", "„Éí„É®„Ç≥": "üê•",
            "„Ç´„É¢": "ü¶Ü", "„ÉÑ„É´": "ü¶¢", "„Éè„Éà": "üïäÔ∏è", "„Ç´„É©„Çπ": "üê¶‚Äç‚¨õ", "„Ç§„É≥„Ç≥": "ü¶ú", "„Ç™„Ç¶„É†": "ü¶ú",
            "„Ç´„Ç®„É´": "üê∏", "„Ç´„É°": "üê¢", "„Çµ„Ç´„Éä": "üêü", "„Çø„Ç≥": "üêô", "„Ç®„Éì": "ü¶ê", "„Ç´„Éã": "ü¶Ä",
            "Ë≤ù": "üêö", "Ëô´": "üêõ", "„ÉÅ„Éß„Ç¶": "ü¶ã", "„Éè„ÉÅ": "üêù", "„ÉÜ„É≥„Éà„Ç¶„É†„Ç∑": "üêû", "„Ç¢„É™": "üêú",
            "„Éå„Éº": "üêÇ", "„É©„ÇØ„ÉÄ": "üê´", "„Ç¢„É´„Éë„Ç´": "ü¶ô", "„É©„Éû": "ü¶ô", "„É≠„Éê": "ü´è", "Êü¥Áä¨": "üêï",
            "„Éâ„Éº„Éô„É´„Éû„É≥": "üêï‚Äçü¶∫", "Âúü‰ΩêÁä¨": "üêï", "„Çª„É≥„Éà„Éê„Éº„Éä„Éº„Éâ": "üê∂", "„Éö„É´„Ç∑„É£Áå´": "üêà", "‰∏âÊØõÁå´": "üêà",
            "ÈªíÁå´": "üêà‚Äç‚¨õ", "„É§„Éû„Éç„Ç≥": "üê±", "„Ç¢„É©„Ç§„Ç∞„Éû": "ü¶ù", "„Çø„Éå„Ç≠": "üçÉ", "„Ç§„Çø„ÉÅ": "ü¶¶", "„Çπ„Ç´„É≥„ÇØ": "ü¶®",
            "„Éè„É™„Éç„Ç∫„Éü": "ü¶î", "„É§„Éû„Ç¢„É©„Ç∑": "ü¶î", "„É¢„Ç∞„É©": "üï≥Ô∏è", "„Éì„Éº„Éê„Éº": "ü¶´", "„Ç´„Éî„Éê„É©": "ü•î",
            "„Ç´„ÉØ„Ç¶„ÇΩ": "ü¶¶", "„É©„ÉÉ„Ç≥": "ü¶¶", "„Ç¢„Ç∂„É©„Ç∑": "ü¶≠", "„Ç¢„Ç∑„Ç´": "ü¶≠", "„Çª„Ç§„Ç¶„ÉÅ": "ü¶≠", "„Ç∏„É•„Ç¥„É≥": "üêã",
            "„Ç§„É´„Ç´": "üê¨", "„Éû„É≥„Éú„Ç¶": "üêü", "„Ç¢„É≥„Ç≥„Ç¶": "üî¶", "„Çø„ÉÑ„Éé„Ç™„Éà„Ç∑„Ç¥": "üêâ", "„Ç¶„Éü„Ç¨„É°": "üê¢",
            "„Éï„É©„Éü„É≥„Ç¥": "ü¶©", "„ÇØ„Ç∏„É£„ÇØ": "ü¶ö", "ÁôΩÈ≥•": "ü¶¢", "„Ç≠„Ç∏": "üê¶", "„Ç≠„ÉÑ„ÉÑ„Ç≠": "üê¶", "„Ç´„ÉØ„Çª„Éü": "üê¶",
            "„ÉÑ„Éê„É°": "üê¶", "„Éà„Éé„Çµ„Éû„Ç¨„Ç®„É´": "üê∏", "„Ç¢„Éû„Ç¨„Ç®„É´": "üê∏", "„Ç¶„Éº„Éë„Éº„É´„Éº„Éë„Éº": "ü¶é", "„Ç§„É¢„É™": "ü¶é",
            "„É§„É¢„É™": "ü¶é", "„É™„ÇØ„Ç¨„É°": "üê¢", "„É¢„É´„É¢„ÉÉ„Éà": "üêπ", "„ÉÅ„É≥„ÉÅ„É©": "üê≠", "„Éï„Çß„É¨„ÉÉ„Éà": "ü¶¶",
            "„Éè„ÉÑ„Ç´„Éç„Ç∫„Éü": "üêÅ", "„Çπ„Ç∫„É°": "üê¶", "ÈáëÈ≠ö": "üêü", "„Ç≥„Ç§": "üêü", "„É°„ÉÄ„Ç´": "üêü", "„Éâ„Ç∏„Éß„Ç¶": "üêü",
            "„Ç∂„É™„Ç¨„Éã": "ü¶û", "„Çµ„ÉØ„Ç¨„Éã": "ü¶Ä", "„É§„Éâ„Ç´„É™": "üêö", "„Ç¢„Çµ„É™": "üêö", "„Ç∑„Ç∏„Éü": "üêö", "„Ç´„Çø„ÉÑ„É†„É™": "üêå",
            "„Éä„É°„ÇØ„Ç∏": "üêå", "„Éü„Éü„Ç∫": "ü™±", "„Ç∑„É≠„Ç¢„É™": "üêú", "„Ç¢„Éñ„É©„É†„Ç∑": "üêõ", "„Ç¨": "ü¶ã", "„Éü„ÉÑ„Éê„ÉÅ": "üêù",
            "„Ç¢„Ç∑„Éä„Ç¨„Éê„ÉÅ": "üêù", "„Éè„Ç®": "ü™∞", "„Ç´": "ü¶ü", "„Ç¥„Ç≠„Éñ„É™": "ü™≥", "„Éé„Éü": "üêõ", "„ÉÄ„Éã": "üï∑Ô∏è",
            "„Éê„ÉÉ„Çø": "ü¶ó", "„Ç≥„Ç™„É≠„ÇÆ": "ü¶ó", "„Çπ„Ç∫„É†„Ç∑": "ü¶ó", "„Çª„Éü": "ü¶ó", "„Éõ„Çø„É´": "üî¶", "„Ç¢„É°„É≥„Éú": "ü¶ü",
            "„Ç≤„É≥„Ç¥„É≠„Ç¶": "ü™≤", "„Çø„Ç¨„É°": "ü™≤", "„Éü„Ç∫„Ç´„Éû„Ç≠„É™": "ü¶ó", "„Çæ„Ç¶„É™„É†„Ç∑": "ü¶†", "„Éü„Ç∏„É≥„Ç≥": "ü¶†",
            "„Ç¢„É°„Éº„Éê": "ü¶†", "„Éó„É©„Éä„É™„Ç¢": "ü™±", "„ÇØ„É™„Ç™„Éç": "üßö", "„ÇØ„É©„Ç≤": "ü™º", "„Éí„Éà„Éá": "‚≠ê", "„Ç¶„Éã": "ü¶î",
            "„Éä„Éû„Ç≥": "ü•í", "„Éï„Ç∞": "üê°", "„Ç§„ÉØ„Ç∑": "üêü", "„Ç¢„Ç∏": "üêü", "„Çµ„Éê": "üêü", "„Çµ„É≥„Éû": "üêü", "„Çø„Ç§": "üêü",
            "„Éû„Ç∞„É≠": "üêü", "„Çµ„Ç±": "üêü", "„É©„Éº„ÉÜ„É´": "ü¶°", "„ÇØ„Ç∫„É™": "ü¶°", "„Çø„Çπ„Éû„Éã„Ç¢„Éá„Éì„É´": "üëø", "„Éû„É≥„Éâ„É™„É´": "üêí"
        };

        const getEmoji = (name) => {
            for (const [key, emoji] of Object.entries(ANIMAL_EMOJIS)) {
                if (name.includes(key)) return emoji;
            }
            return "üêæ"; // Default
        };

        const CARD_DATA_RAW = {
            GOD: ["Ââµ‰∏ñ„ÅÆ„Éõ„ÉØ„Ç§„Éà„É©„Ç§„Ç™„É≥", "ÁµÇÁÑâ„ÅÆ„Éñ„É©„ÉÉ„ÇØ„Éâ„É©„Ç¥„É≥", "ÊôÇÁ©∫„ÅÆ„ÇØ„Ç∏„É©„Éª„Ç≥„Çπ„É¢„Ç™„Éº„Ç∑„É£„É≥"],
            LEGEND: ["„Ç¥„Éº„É´„Éá„É≥„Éª„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ", "Ê∑±Êµ∑Áéã„ÇØ„É©„Éº„Ç±„É≥", "Èõ∑Â∏ù„Ç∞„É™„Éï„Ç©„É≥", "ÈãºÈâÑ„ÅÆ„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ", "Ê•µÂåó„ÅÆÂπªÁç£„Éû„É≥„É¢„Çπ", "ÁÅºÁÜ±„ÅÆ„Çµ„É©„Éû„É≥„ÉÄ„Éº", "Êö¥È¢®„ÅÆ„Éö„Ç¨„Çµ„Çπ", "ÁåõÊØí„ÅÆ„Ç≠„É≥„Ç∞„Éí„Éâ„É©", "ÈúäÂ≥∞„ÅÆ‰πùÂ∞æ„ÅÆÁãê", "Ë≥¢ËÄÖ„Çπ„Éï„Ç£„É≥„ÇØ„Çπ"],
            ULTIMATE: ["„Ç≠„É≥„Ç∞„Ç≥„É≥„Ç∞„Éª„Ç¥„É™„É©", "„É°„Ç¨„É≠„Éâ„É≥ÔºàÂè§‰ª£„Ç∂„É°Ôºâ", "ÁöáÂ∏ù„Éö„É≥„ÇÆ„É≥„Éª„Ç∏„Çß„Éç„É©„É´", "„Ç¢„Éº„Éû„Éº„Éâ„Éª„Çµ„Ç§", "Ââ£Ë±™„Ç´„Éû„Ç≠„É™", "„Éá„Çπ„Éª„Çπ„Ç≥„Éº„Éî„Ç™„É≥", "„Éû„ÉÉ„Éè„Éª„Éè„É§„Éñ„Çµ", "„Ç∏„É£„Ç§„Ç¢„É≥„Éà„Éª„Ç¢„Éä„Ç≥„É≥„ÉÄ", "„Éô„É≥„Ç¨„É´„Éª„Çø„Ç§„Ç¨„ÉºÔºàË¶öÈÜíÔºâ", "„Ç∞„É¨„Éº„Éà„Éª„Éõ„ÉØ„Ç§„Éà„Éª„Éô„Ç¢Ôºà„Ç∑„É≠„ÇØ„ÉûÔºâ", "„Éä„Ç§„É´„Éª„ÇØ„É≠„Ç≥„ÉÄ„Ç§„É´ÔºàÁãÇÊö¥ÂåñÔºâ", "„Ç®„É¨„ÇØ„Éà„É≠„Éª„Ç§„Éº„É´ÔºàÈõªÊ∞ó„Ç¶„Éä„ÇÆÔºâ", "„Éù„Ç§„Ç∫„É≥„Éª„ÉÄ„Éº„Éà„Éï„É≠„ÉÉ„Ç∞", "„Ç´„Éñ„Éà„É†„Ç∑„Éª„Éò„É©„ÇØ„É¨„Çπ", "‰æç„Ç§„Éº„Ç∞„É´", "ÂøçËÄÖ„É†„Çµ„Çµ„Éì", "ÂπªÊÉë„ÅÆ„Ç´„É°„É¨„Ç™„É≥", "ÈâÑÂ£Å„ÅÆ„Ç¢„É´„Éû„Ç∏„É≠", "Âê∏Ë°Ä„Ç≥„Ç¶„É¢„É™„Éª„É≠„Éº„Éâ", "Â≠§È´ò„ÅÆ„Ç™„Ç™„Ç´„Éü„Éª„É™„Éº„ÉÄ„Éº"],
            EPIC: ["„Ç¢„Éï„É™„Ç´„Çæ„Ç¶", "ÁôæÁç£„ÅÆÁéã„É©„Ç§„Ç™„É≥", "„ÉÅ„Éº„Çø„Éº", "„Éí„Éß„Ç¶", "„Ç∏„É£„Ç¨„Éº", "„Ç´„Éê", "„Ç≠„É™„É≥ÔºàÊ†ºÈóò„Çø„Ç§„ÉóÔºâ", "„Éê„ÉÉ„Éï„Ç°„É≠„Éº", "„Ç§„Éé„Ç∑„Ç∑ÔºàÁ™ÅÈÄ≤Ôºâ", "ÈóòÁâõ", "„Ç´„É≥„Ç¨„É´„ÉºÔºà„Éú„ÇØ„Çµ„ÉºÔºâ", "„Ç≥„É¢„Éâ„Éâ„É©„Ç¥„É≥", "„Ç™„Ç™„Éà„Ç´„Ç≤", "„ÉØ„Éã„Ç¨„É°", "„Éã„Ç∑„Ç≠„Éò„Éì", "„Ç≠„É≥„Ç∞„Ç≥„Éñ„É©", "„Ç¨„É©„Ç¨„É©„Éò„Éì", "„Ç™„Ç™„ÉØ„Ç∑", "„Ç≥„É≥„Éâ„É´", "„Éï„ÇØ„É≠„Ç¶ÔºàÂ§úË•≤Ôºâ", "„ÉÄ„ÉÅ„Éß„Ç¶", "„Éí„ÇØ„Ç§„Éâ„É™", "„Éõ„Éõ„Ç∏„É≠„Ç∂„É°", "„Ç∑„É£„ÉÅ", "„Ç∑„É•„É¢„ÇØ„Ç∂„É°", "„ÉÄ„Ç§„Ç™„Ç¶„Ç§„Ç´", "„Ç®„Ç§ÔºàÊØíÈáùÔºâ", "„Éî„É©„Éã„Ç¢Áæ§", "„Ç™„Ç™„Çπ„Ç∫„É°„Éê„ÉÅ", "„ÇÆ„É©„Éï„Ç°„Éé„Ç≥„ÇÆ„É™„ÇØ„ÉØ„Ç¨„Çø", "„Ç™„Éã„É§„É≥„Éû", "„Çø„É©„É≥„ÉÅ„É•„É©", "„É†„Ç´„Éá", "„Ç∞„É™„Ç∫„É™„Éº", "„Éë„É≥„ÉÄÔºà„Ç´„É≥„Éï„ÉºÔºâ", "„Éû„É≥„Éâ„É™„É´", "„Ç™„É©„É≥„Ç¶„Éº„Çø„É≥", "„É©„Éº„ÉÜ„É´ÔºàÊúÄÂº∑„ÅÆÊ†πÊÄßÔºâ", "„ÇØ„Ç∫„É™", "„Çø„Çπ„Éû„Éã„Ç¢„Éá„Éì„É´"],
            RARE: ["„Ç∑„Éû„Ç¶„Éû", "„Ç¨„Çº„É´", "„Éå„Éº", "„É©„ÇØ„ÉÄ", "„Ç¢„É´„Éë„Ç´", "„É©„Éû", "„É≠„Éê", "„É§„ÇÆ", "„Éí„ÉÑ„Ç∏", "„Éõ„É´„Çπ„Çø„Ç§„É≥ÔºàÁâõÔºâ", "„Éñ„Çø", "Êü¥Áä¨", "„Éâ„Éº„Éô„É´„Éû„É≥", "Âúü‰ΩêÁä¨", "„Çª„É≥„Éà„Éê„Éº„Éä„Éº„Éâ", "„Éö„É´„Ç∑„É£Áå´", "‰∏âÊØõÁå´", "ÈªíÁå´", "„É§„Éû„Éç„Ç≥", "„Ç¢„É©„Ç§„Ç∞„Éû", "„Çø„Éå„Ç≠", "„Ç≠„ÉÑ„Éç", "„Ç§„Çø„ÉÅ", "„Çπ„Ç´„É≥„ÇØ", "„Éè„É™„Éç„Ç∫„Éü", "„É§„Éû„Ç¢„É©„Ç∑", "„É¢„Ç∞„É©", "„Éì„Éº„Éê„Éº", "„Ç´„Éî„Éê„É©", "„Ç´„ÉØ„Ç¶„ÇΩ", "„É©„ÉÉ„Ç≥", "„Ç¢„Ç∂„É©„Ç∑", "„Ç¢„Ç∑„Ç´", "„Çª„Ç§„Ç¶„ÉÅ", "„Ç∏„É•„Ç¥„É≥", "„Ç§„É´„Ç´", "„Éû„É≥„Éú„Ç¶", "„Ç¢„É≥„Ç≥„Ç¶", "„Çø„ÉÑ„Éé„Ç™„Éà„Ç∑„Ç¥", "„Ç¶„Éü„Ç¨„É°", "„Éö„É≥„ÇÆ„É≥", "„Éï„É©„Éü„É≥„Ç¥", "„ÇØ„Ç∏„É£„ÇØ", "„ÉÑ„É´", "ÁôΩÈ≥•", "„Ç´„É¢", "„Ç≠„Ç∏", "„Ç≠„ÉÑ„ÉÑ„Ç≠", "„Ç´„ÉØ„Çª„Éü", "„ÉÑ„Éê„É°", "„Éè„Éà", "„Ç´„É©„Çπ", "„Ç§„É≥„Ç≥", "„Ç™„Ç¶„É†", "„Éà„Éé„Çµ„Éû„Ç¨„Ç®„É´", "„Ç¢„Éû„Ç¨„Ç®„É´", "„Ç¶„Éº„Éë„Éº„É´„Éº„Éë„Éº", "„Ç§„É¢„É™", "„É§„É¢„É™", "„É™„ÇØ„Ç¨„É°"],
            COMMON: ["„Éç„Ç∫„Éü", "„Éè„É†„Çπ„Çø„Éº", "„É™„Çπ", "„Ç¶„Çµ„ÇÆ", "„É¢„É´„É¢„ÉÉ„Éà", "„ÉÅ„É≥„ÉÅ„É©", "„Éï„Çß„É¨„ÉÉ„Éà", "„Éè„ÉÑ„Ç´„Éç„Ç∫„Éü", "„Ç≥„Ç¶„É¢„É™", "„Çπ„Ç∫„É°", "„Éí„É®„Ç≥", "„Éã„ÉØ„Éà„É™", "„Ç¢„Éí„É´", "ÈáëÈ≠ö", "„Ç≥„Ç§", "„É°„ÉÄ„Ç´", "„Éâ„Ç∏„Éß„Ç¶", "„Ç∂„É™„Ç¨„Éã", "„Çµ„ÉØ„Ç¨„Éã", "„É§„Éâ„Ç´„É™", "„Ç¢„Çµ„É™", "„Ç∑„Ç∏„Éü", "„Ç´„Çø„ÉÑ„É†„É™", "„Éä„É°„ÇØ„Ç∏", "„Éü„Éü„Ç∫", "„Ç¢„É™", "„Ç∑„É≠„Ç¢„É™", "„Ç¢„Éñ„É©„É†„Ç∑", "„ÉÜ„É≥„Éà„Ç¶„É†„Ç∑", "„ÉÅ„Éß„Ç¶", "„Ç¨", "„Éü„ÉÑ„Éê„ÉÅ", "„Çπ„Ç∫„É°„Éê„ÉÅÔºàÂ∞èÂûãÔºâ", "„Ç¢„Ç∑„Éä„Ç¨„Éê„ÉÅ", "„Éè„Ç®", "„Ç´", "„Ç¥„Ç≠„Éñ„É™", "„Éé„Éü", "„ÉÄ„Éã", "„ÇØ„É¢", "„Éê„ÉÉ„Çø", "„Ç≥„Ç™„É≠„ÇÆ", "„Çπ„Ç∫„É†„Ç∑", "„Ç´„Éû„Ç≠„É™ÔºàÂ∞èÂûãÔºâ", "„Çª„Éü", "„Éõ„Çø„É´", "„Éà„É≥„Éú", "„Ç¢„É°„É≥„Éú", "„Ç≤„É≥„Ç¥„É≠„Ç¶", "„Çø„Ç¨„É°", "„Éü„Ç∫„Ç´„Éû„Ç≠„É™", "„Çæ„Ç¶„É™„É†„Ç∑", "„Éü„Ç∏„É≥„Ç≥", "„Ç¢„É°„Éº„Éê", "„Éó„É©„Éä„É™„Ç¢", "„ÇØ„É™„Ç™„Éç", "„ÇØ„É©„Ç≤", "„Éí„Éà„Éá", "„Ç¶„Éã", "„Éä„Éû„Ç≥", "„Éï„Ç∞", "„Ç§„ÉØ„Ç∑", "„Ç¢„Ç∏", "„Çµ„Éê", "„Çµ„É≥„Éû", "„Çø„Ç§", "„Éû„Ç∞„É≠", "„Çµ„Ç±", "„Çø„Ç≥", "„Ç§„Ç´"]
        };

        const ALL_CARDS = [];
        let cardIdCounter = 1;
        Object.keys(CARD_DATA_RAW).forEach(rarity => {
            CARD_DATA_RAW[rarity].forEach((name) => {
                const powerVar = Math.floor(Math.random() * 400);
                const hpVar = Math.floor(Math.random() * 800);
                ALL_CARDS.push({
                    id: cardIdCounter++,
                    name: name,
                    rarity: rarity,
                    power: RARITY_CONFIG[rarity].powerBase + powerVar,
                    hp: RARITY_CONFIG[rarity].hpBase + hpVar,
                    cost: RARITY_CONFIG[rarity].cost,
                    description: `Rank ${rarity} Beast`
                });
            });
        });

        const MISSION_POOL = [
            { id: 'm1', text: '„Éê„Éà„É´„Çí1ÂõûË°å„ÅÜ', target: 1, reward: 300, type: 'BATTLE_COUNT' },
            { id: 'm2', text: '„Çπ„Ç´„Ç¶„Éà(„Ç¨„ÉÅ„É£)„Çí1ÂõûË°å„ÅÜ', target: 1, reward: 500, type: 'GACHA_COUNT' },
            { id: 'm3', text: '„Éû„Éº„Ç±„ÉÉ„Éà„ÇíË¶ã„Çã', target: 1, reward: 100, type: 'VISIT_MARKET' },
            { id: 'm4', text: '„Éê„Éà„É´„ÅßÂãùÂà©„Åô„Çã', target: 1, reward: 400, type: 'BATTLE_WIN' },
            { id: 'm5', text: '„Ç´„Éº„Éâ„ÇíÂ£≤Âç¥„Åô„Çã', target: 1, reward: 200, type: 'SELL_CARD' },
            { id: 'm6', text: '„Éê„Éà„É´„Çí3ÂõûË°å„ÅÜ', target: 3, reward: 800, type: 'BATTLE_COUNT' },
        ];

        // --- UI COMPONENTS ---

        const Card = ({ card, isNew, size = "normal", showPower = true, isHidden = false, onClick, className = "", isRental = false, isSelected = false, level = 0 }) => {
            if (!card) return <div className="w-24 h-36 bg-gray-800 rounded-lg animate-pulse"></div>;
            
            const levelMultiplier = 1 + (level * 0.1);
            const displayPower = Math.floor(card.power * levelMultiplier);
            const displayHp = Math.floor(card.hp * levelMultiplier);

            if (isHidden) {
                return (
                    <div className={`relative rounded-xl bg-gray-900 border-2 border-gray-700 flex flex-col items-center justify-center ${size === "small" ? "w-24 h-32 text-xs" : "w-48 h-64 text-xl"} shadow-xl overflow-hidden ${className}`}>
                        <div className="text-gray-700 font-bold">?</div>
                        <div className="text-gray-600 text-[10px] mt-1">UNKNOWN</div>
                    </div>
                );
            }

            const config = RARITY_CONFIG[card.rarity];
            const isHolo = card.rarity === 'GOD' || card.rarity === 'LEGEND';
            const glowClass = isHolo ? "animate-pulse ring-2 ring-yellow-400/50" : "";
            const bgGradient = `bg-gradient-to-br ${config.color}`;
            const dimClass = size === "small" ? "w-24 h-32 text-[10px]" : "w-48 h-64";
            const titleSize = size === "small" ? "text-[10px]" : "text-sm";
            const emojiSize = size === "small" ? "text-4xl" : "text-7xl";
            const emoji = useMemo(() => getEmoji(card.name), [card.name]);

            return (
                <div onClick={onClick} className={`relative rounded-xl p-0.5 transition-all duration-300 transform ${onClick ? 'cursor-pointer active:scale-95' : ''} ${glowClass} ${bgGradient} shadow-lg ${className} ${isSelected ? "ring-4 ring-green-500" : ""}`}>
                    <div className={`h-full w-full bg-gray-900 rounded-lg overflow-hidden flex flex-col relative ${dimClass}`}>
                        
                        {/* Background Pattern */}
                        <div className="absolute inset-0 bg-gray-800 opacity-50" style={{backgroundImage: 'radial-gradient(#ffffff10 1px, transparent 1px)', backgroundSize: '10px 10px'}}></div>
                        {isHolo && <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent animate-[shimmer_3s_infinite] pointer-events-none" style={{backgroundSize: '200% 100%'}} />}

                        {/* Top Info */}
                        <div className="absolute top-0 left-0 z-10 flex justify-between items-center p-1 w-full">
                            <span className={`font-black ${config.text} drop-shadow-md px-1 bg-black/40 rounded`}>{card.rarity.substring(0,1)}</span>
                            <span className="text-white/90 font-mono bg-black/50 px-1 rounded text-[10px]">Lv.{level+1}</span>
                        </div>

                        {/* Emoji Icon */}
                        <div className={`flex-1 flex items-center justify-center z-10 ${emojiSize} filter drop-shadow-lg`}>
                            {emoji}
                        </div>

                        {/* Bottom Info */}
                        <div className="relative z-10 w-full p-1.5 text-center bg-gradient-to-t from-black/90 to-transparent">
                            <h3 className={`${titleSize} font-bold text-white mb-1 leading-tight line-clamp-2 min-h-[2.4em] flex items-center justify-center drop-shadow-md`}>
                                {card.name}
                            </h3>
                            {showPower && (
                                <div className="flex justify-between gap-1 text-[9px] font-mono text-white bg-black/60 rounded px-1 py-0.5 backdrop-blur-sm border border-white/10">
                                    <span className="text-green-400">HP {displayHp}</span>
                                    <span className="text-red-400">ATK {displayPower}</span>
                                </div>
                            )}
                        </div>

                        {isNew && <div className="absolute top-3 -right-8 bg-red-600 text-white text-[8px] font-bold px-8 py-0.5 rotate-45 shadow-lg z-20">NEW</div>}
                        {isRental && <div className="absolute top-3 -left-8 bg-blue-600 text-white text-[8px] font-bold px-8 py-0.5 -rotate-45 shadow-lg z-20">RENTAL</div>}
                        {isSelected && <div className="absolute inset-0 bg-green-500/30 z-30 flex items-center justify-center"><Icons.CheckCircle size={32} className="text-white drop-shadow-lg"/></div>}
                    </div>
                </div>
            );
        };

        const Button = ({ children, onClick, variant = "primary", disabled = false, className = "", size="normal" }) => {
            const baseStyle = "rounded-lg font-bold transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:grayscale";
            const sizeStyles = size === "small" ? "px-2 py-1 text-xs" : "px-4 py-3 text-sm md:text-base";
            const variants = {
                primary: "bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white shadow-lg shadow-blue-900/30",
                secondary: "bg-gray-700 hover:bg-gray-600 text-white border border-gray-600",
                gold: "bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-white shadow-lg shadow-yellow-900/30",
                danger: "bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-900/30",
                green: "bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-900/30"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${sizeStyles} ${variants[variant]} ${className}`}>{children}</button>
            );
        };

        // --- ANIMATION & MODALS ---
        const PackOpener = ({ onOpen }) => {
            const [cutProgress, setCutProgress] = useState(0);
            const [isCut, setIsCut] = useState(false);
            const packRef = useRef(null);
            const isDragging = useRef(false);
            const handleStart = () => { isDragging.current = true; };
            const handleMove = (e) => {
                if (!isDragging.current || isCut) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const rect = packRef.current.getBoundingClientRect();
                const x = clientX - rect.left;
                const progress = Math.min(100, Math.max(0, (x / rect.width) * 100));
                setCutProgress(progress);
                if (progress > 85) { setIsCut(true); setTimeout(onOpen, 600); }
            };
            const handleEnd = () => { isDragging.current = false; if (!isCut) setCutProgress(0); };
            return (
                <div className="flex flex-col items-center justify-center h-full w-full animate-in fade-in zoom-in fixed inset-0 bg-black/80 z-50" style={{zIndex: 20000}}>
                   <div className="relative w-64 h-96 bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-xl shadow-2xl border-4 border-yellow-400 flex items-center justify-center overflow-hidden select-none"
                        ref={packRef} onMouseDown={handleStart} onMouseMove={handleMove} onMouseUp={handleEnd} onMouseLeave={handleEnd} onTouchStart={handleStart} onTouchMove={handleMove} onTouchEnd={handleEnd}>
                       <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 pointer-events-none"></div>
                       <div className="z-10 text-center pointer-events-none"><h2 className="text-4xl font-black text-white drop-shadow-lg italic">WILD<br/>PACK</h2><div className="mt-4 text-yellow-200 font-bold text-sm">SWIPE TOP ‚úÇÔ∏è</div></div>
                       <div className={`absolute top-0 left-0 w-full h-24 bg-gray-900/20 transition-transform duration-500 ${isCut ? 'translate-x-full rotate-12 opacity-0' : ''} pointer-events-none border-b-2 border-dashed border-white/50`}></div>
                       <div className="absolute top-0 left-0 w-full h-24 z-20 cursor-col-resize"><div className="absolute top-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-900 pointer-events-none transition-all duration-75" style={{ left: `${cutProgress}%`, transform: 'translate(-50%, -50%)' }}><Icons.Scissors size={20} /></div></div>
                       {isCut && <div className="absolute inset-0 bg-white animate-pulse z-50 pointer-events-none"></div>}
                   </div>
                   <p className="mt-8 text-gray-300 animate-bounce font-bold">ÁÇπÁ∑ö„Å´Ê≤ø„Å£„Å¶Âè≥„Å∏„Çπ„ÉØ„Ç§„ÉóÔºÅ</p>
                </div>
            );
        };

        const BattleTimer = ({ onComplete }) => {
            const [size, setSize] = useState(200);
            const [isActive, setIsActive] = useState(true);
            const [result, setResult] = useState(null);
            const reqRef = useRef();
            const startTime = useRef(Date.now());
            useEffect(() => {
                const animate = () => {
                    if (!isActive) return;
                    const elapsed = Date.now() - startTime.current;
                    const duration = 1500;
                    const progress = (elapsed % duration) / duration;
                    setSize(200 * (1 - progress));
                    reqRef.current = requestAnimationFrame(animate);
                };
                reqRef.current = requestAnimationFrame(animate);
                return () => cancelAnimationFrame(reqRef.current);
            }, [isActive]);
            const handleStop = () => {
                if (!isActive) return;
                setIsActive(false);
                cancelAnimationFrame(reqRef.current);
                const target = 50;
                const diff = Math.abs(size - target);
                let multiplier = 1.0, label = "MISS...", color = "text-gray-400";
                if (diff < 15) { multiplier = 2.0; label = "PERFECT!!"; color = "text-yellow-400"; }
                else if (diff < 40) { multiplier = 1.5; label = "GREAT!"; color = "text-green-400"; }
                else if (diff < 70) { multiplier = 1.1; label = "GOOD"; color = "text-blue-400"; }
                else { multiplier = 0.8; label = "BAD..."; color = "text-red-400"; }
                setResult({ multiplier, label, color });
                setTimeout(() => onComplete(multiplier), 1000);
            };
            return (
                <div className="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-black/80 backdrop-blur-md" onTouchStart={(e)=>e.stopPropagation()} onClick={(e)=>e.stopPropagation()} onTouchEnd={handleStop} onMouseDown={handleStop}>
                    {!result ? (
                        <div className="relative w-64 h-64 flex items-center justify-center cursor-pointer">
                            <h3 className="absolute -top-16 text-white font-bold text-2xl animate-pulse text-center w-full drop-shadow-lg">TAP TO STOP!</h3>
                            <div className="absolute w-[50px] h-[50px] border-4 border-white rounded-full shadow-[0_0_20px_rgba(255,255,255,0.8)]"></div>
                            <div className="absolute border-4 border-red-500 rounded-full opacity-80 box-border" style={{ width: Math.max(0, size)+'px', height: Math.max(0, size)+'px' }}></div>
                        </div>
                    ) : (
                        <div className={`font-black ${result.color} text-5xl animate-in zoom-in duration-200 drop-shadow-2xl flex flex-col items-center`}>
                            <div>{result.label}</div>
                            <div className="text-white text-xl mt-2 font-mono">POWER x{result.multiplier}</div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---

        function AnimalChronicle() {
            const [coins, setCoins] = useState(1000);
            const [collection, setCollection] = useState({});
            const [cardLevels, setCardLevels] = useState({});
            const [view, setView] = useState('HOME');
            const [packState, setPackState] = useState('IDLE');
            const [pendingPackCards, setPendingPackCards] = useState(null);
            const [battleState, setBattleState] = useState(null);
            const [isBattleTiming, setIsBattleTiming] = useState(false);
            const [damageAnim, setDamageAnim] = useState({ active: false, target: null, value: 0 });
            const [selectedDeck, setSelectedDeck] = useState([]);
            const [selectedCard, setSelectedCard] = useState(null);
            const [loginBonus, setLoginBonus] = useState(null);
            const [lastFreePackClaim, setLastFreePackClaim] = useState(0);
            const [freePackProgress, setFreePackProgress] = useState(0);
            const [timeUntilFreePack, setTimeUntilFreePack] = useState("");
            const [lastDailyReset, setLastDailyReset] = useState("");
            const [activeMissions, setActiveMissions] = useState([]);
            const [missionProgress, setMissionProgress] = useState({});
            const [claimedMissions, setClaimedMissions] = useState([]);
            const [showMissions, setShowMissions] = useState(false);
            const [marketTab, setMarketTab] = useState('SHOP');
            const [shopItems, setShopItems] = useState([]);
            const [auctionItems, setAuctionItems] = useState([]);

            useEffect(() => {
                const saved = localStorage.getItem('animalChronicleData_v10');
                let lastLoginDate = "";
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setCoins(parsed.coins || 1000);
                    setCollection(parsed.collection || {});
                    setCardLevels(parsed.cardLevels || {});
                    setLastFreePackClaim(parsed.lastFreePackClaim || 0);
                    setLastDailyReset(parsed.lastDailyReset || "");
                    setActiveMissions(parsed.activeMissions || []);
                    setMissionProgress(parsed.missionProgress || {});
                    setClaimedMissions(parsed.claimedMissions || []);
                    lastLoginDate = parsed.lastLoginDate || "";
                }
                const today = new Date().toLocaleDateString('ja-JP');
                if (lastLoginDate !== today) setTimeout(() => setLoginBonus(500), 1000);
                refreshShop();
                checkDailyReset(saved ? JSON.parse(saved).lastDailyReset : "");
            }, []);

            useEffect(() => {
                const today = new Date().toLocaleDateString('ja-JP');
                localStorage.setItem('animalChronicleData_v10', JSON.stringify({
                    coins, collection, cardLevels, lastFreePackClaim, lastDailyReset, activeMissions, missionProgress, claimedMissions, lastLoginDate: today
                }));
            }, [coins, collection, cardLevels, lastFreePackClaim, lastDailyReset, activeMissions, missionProgress, claimedMissions]);

            useEffect(() => {
                const interval = setInterval(() => {
                    const now = Date.now();
                    const msSinceClaim = now - lastFreePackClaim;
                    const msCooldown = 24 * 60 * 60 * 1000;
                    if (msSinceClaim >= msCooldown) {
                        setFreePackProgress(100);
                        setTimeUntilFreePack("READY");
                    } else {
                        const percent = (msSinceClaim / msCooldown) * 100;
                        setFreePackProgress(Math.min(100, Math.max(0, percent)));
                        const msLeft = msCooldown - msSinceClaim;
                        const h = Math.floor(msLeft / (1000 * 60 * 60));
                        const m = Math.floor((msLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const s = Math.floor((msLeft % (1000 * 60)) / 1000);
                        setTimeUntilFreePack(`${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`);
                    }
                    setAuctionItems(prev => prev.map(item => {
                        if (item.endTime <= now) return item;
                        const timeLeft = (item.endTime - now) / 1000;
                        const rivalBidChance = item.lastBidder === 'YOU' ? 0.3 : 0.05; 
                        if (Math.random() < rivalBidChance && timeLeft > 0) {
                            const raise = Math.floor(Math.random() * 500) + 100;
                            // NPC will not bid if currentBid >= buyoutPrice (which is approx 2x startPrice)
                            if (item.currentBid < item.buyoutPrice) {
                                const newBid = item.currentBid + raise;
                                // If NPC bids and exceeds buyout, they take it instantly? Or just bid high.
                                // Simpler: NPC bids normally.
                                // But we check for buyout later.
                                return { ...item, currentBid: newBid, lastBidder: 'Rival' };
                            }
                        }
                        // Check Buyout Condition for NPC or Time
                        if (item.currentBid >= item.buyoutPrice && item.endTime > now) {
                             // Force end if price gets too high (Immediate Buyout Logic)
                             return { ...item, endTime: now };
                        }
                        return item;
                    }));
                    checkDailyReset(lastDailyReset);
                }, 1000);
                return () => clearInterval(interval);
            }, [lastFreePackClaim, lastDailyReset]);

            const checkDailyReset = (currentLastResetDate) => {
                const today = new Date().toLocaleDateString('ja-JP');
                if (today !== currentLastResetDate) {
                    const shuffled = [...MISSION_POOL].sort(() => 0.5 - Math.random());
                    setActiveMissions(shuffled.slice(0, 3));
                    setMissionProgress({});
                    setClaimedMissions([]);
                    setLastDailyReset(today);
                    refreshShop();
                }
            };
            const updateMission = (type, amount = 1) => {
                const newProgress = { ...missionProgress };
                let updated = false;
                activeMissions.forEach(m => {
                    if (m.type === type) {
                        const current = newProgress[m.id] || 0;
                        if (current < m.target) {
                            newProgress[m.id] = current + amount;
                            updated = true;
                        }
                    }
                });
                if (updated) setMissionProgress(newProgress);
            };
            const rollRarity = () => {
                const r = Math.random();
                let cumulative = 0;
                const order = ['GOD', 'LEGEND', 'ULTIMATE', 'EPIC', 'RARE', 'COMMON'];
                for (let key of order) {
                    cumulative += RARITY_CONFIG[key].probability;
                    if (r < cumulative) return key;
                }
                return 'COMMON';
            };
            const getRandomCard = (minRarityIndex = 5) => {
                const order = ['GOD', 'LEGEND', 'ULTIMATE', 'EPIC', 'RARE', 'COMMON'];
                let rarity;
                do { rarity = rollRarity(); } while (order.indexOf(rarity) > minRarityIndex);
                const pool = ALL_CARDS.filter(c => c.rarity === rarity);
                return pool[Math.floor(Math.random() * pool.length)];
            };
            const refreshShop = () => {
                const items = [];
                for (let i = 0; i < 4; i++) items.push(getRandomCard());
                setShopItems(items);
            };
            const createAuction = () => {
                const active = auctionItems.filter(i => i.endTime > Date.now()).length;
                if (active >= 2) return;
                let card;
                do { card = getRandomCard(); } while (['COMMON', 'RARE'].includes(card.rarity));
                const startPrice = Math.floor(RARITY_CONFIG[card.rarity].sell * 1.5);
                setAuctionItems(prev => [...prev, { id: Date.now() + Math.random(), card: card, currentBid: startPrice, endTime: Date.now() + 60000, lastBidder: 'System' }]);
            };

            const openPack = (count = 1, isFree = false) => {
                if (isFree) {
                    if (freePackProgress < 100) return;
                    setLastFreePackClaim(Date.now());
                    setFreePackProgress(0);
                } else {
                    const cost = count * 500;
                    if (coins < cost) return;
                    setCoins(prev => prev - cost);
                }
                const newCards = [];
                const draws = isFree ? 5 : count * 5;
                for (let i = 0; i < draws; i++) {
                    const rarity = rollRarity();
                    const pool = ALL_CARDS.filter(c => c.rarity === rarity);
                    const picked = pool[Math.floor(Math.random() * pool.length)];
                    newCards.push(picked);
                }
                setPendingPackCards(newCards);
                setPackState('SHOW_PACK');
            };
            const finishPackOpening = () => {
                const newColl = { ...collection };
                pendingPackCards.forEach(c => { newColl[c.id] = (newColl[c.id] || 0) + 1; });
                setCollection(newColl);
                setPackState('SHOW_RESULTS');
                updateMission('GACHA_COUNT');
            };
            const claimMission = (m) => { setCoins(prev => prev + m.reward); setClaimedMissions(prev => [...prev, m.id]); };
            const sellCard = (card) => {
                if (!collection[card.id] || collection[card.id] <= 0) return;
                const price = RARITY_CONFIG[card.rarity].sell;
                if (!window.confirm(`${card.name} „Çí ${price} G „ÅßÂ£≤Âç¥„Åó„Åæ„Åô„ÅãÔºü`)) return;
                setCoins(prev => prev + price);
                setCollection(prev => ({ ...prev, [card.id]: prev[card.id] - 1 }));
                setSelectedCard(null);
                updateMission('SELL_CARD');
            };
            const levelUpCard = (card) => {
                if (!collection[card.id] || collection[card.id] < 3) return;
                if (!window.confirm(`${card.name} 3Êûö„ÇíÊ∂àË≤ª„Åó„Å¶Ë¶öÈÜí(LvUP)„Åï„Åõ„Åæ„Åô„ÅãÔºü\n(„Çπ„ÉÜ„Éº„Çø„Çπ+10%)`)) return;
                setCollection(prev => ({ ...prev, [card.id]: prev[card.id] - 3 }));
                setCardLevels(prev => ({ ...prev, [card.id]: (prev[card.id] || 0) + 1 }));
                setSelectedCard(null);
            };
            const buyShopItem = (card) => {
                const price = RARITY_CONFIG[card.rarity].buy;
                if (coins < price) { alert("„ÅäÈáë„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ"); return; }
                if (!window.confirm(`${card.name} „Çí ${price} G „ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü`)) return;
                setCoins(prev => prev - price);
                setCollection(prev => ({ ...prev, [card.id]: (prev[card.id] || 0) + 1 }));
                setShopItems(prev => prev.filter(c => c.id !== card.id));
            };
            const placeBid = (auctionId, currentBid) => {
                const bidAmount = currentBid + 100;
                if (coins < bidAmount) { alert("ÂÖ•Êú≠„Åô„Çã„ÅäÈáë„ÅåË∂≥„Çä„Åæ„Åõ„Çì"); return; }
                setAuctionItems(prev => prev.map(item => {
                    if (item.id === auctionId) { return { ...item, currentBid: bidAmount, lastBidder: 'YOU', endTime: item.endTime + 5000 }; }
                    return item;
                }));
            };
            const claimAuction = (item) => {
                if (item.lastBidder !== 'YOU') { setAuctionItems(prev => prev.filter(i => i.id !== item.id)); return; }
                if (coins < item.currentBid) { alert("Ë≥áÈáë‰∏çË∂≥„ÅßÊ®©Âà©Â§±Âäπ„Åß„Åô„ÄÇ"); setAuctionItems(prev => prev.filter(i => i.id !== item.id)); return; }
                setCoins(prev => prev - item.currentBid);
                setCollection(prev => ({ ...prev, [item.card.id]: (prev[item.card.id] || 0) + 1 }));
                setAuctionItems(prev => prev.filter(i => i.id !== item.id));
                alert(`${item.card.name} „ÇíÂÖ•Êâã„Åó„Åæ„Åó„ÅüÔºÅ`);
            };

            const toggleDeckCard = (card) => {
                if (selectedDeck.find(c => c.id === card.id)) { setSelectedDeck(prev => prev.filter(c => c.id !== card.id)); }
                else { if (selectedDeck.length >= 3) return; setSelectedDeck(prev => [...prev, card]); }
            };
            const autoSelectDeck = () => {
                const myIds = Object.keys(collection).filter(id => collection[id] > 0);
                const deck = [];
                const ownedCards = ALL_CARDS.filter(c => myIds.includes(String(c.id)));
                const effectiveCards = ownedCards.map(c => {
                    const level = cardLevels[c.id] || 0;
                    const mult = 1 + (level * 0.1);
                    return { ...c, effectivePower: c.power * mult };
                });
                effectiveCards.sort((a,b) => b.effectivePower - a.effectivePower);
                for(let i=0; i<3; i++) {
                    if(effectiveCards[i]) { const { effectivePower, ...rest } = effectiveCards[i]; deck.push(rest); }
                    else { const rental = ALL_CARDS.find(c => c.rarity === 'COMMON' && c.name === '„Éè„É†„Çπ„Çø„Éº'); deck.push({ ...rental, id: `rental-${i}`, name: `„É¨„É≥„Çø„É´„Éª${rental.name}`, isRental: true }); }
                }
                setSelectedDeck(deck);
            };
            const confirmDeckAndStart = () => {
                if (selectedDeck.length !== 3) { alert("„Ç´„Éº„Éâ„Çí3ÊûöÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑÔºÅ"); return; }
                const myTeam = selectedDeck.map(c => {
                    const level = cardLevels[c.id] || 0;
                    const mult = 1 + (level * 0.1);
                    return { ...c, hp: Math.floor(c.hp * mult), power: Math.floor(c.power * mult), currentHp: Math.floor(c.hp * mult), level: level, isRental: c.isRental || false };
                });
                const playerTotalPower = myTeam.reduce((sum, c) => sum + c.power, 0);
                const playerAvgPower = playerTotalPower / 3;
                const potentialEnemies = ALL_CARDS.filter(c => Math.abs(c.power - playerAvgPower) < 2000);
                const enemyTeam = [];
                for(let i=0; i<3; i++) {
                    const base = potentialEnemies.length > 0 ? potentialEnemies[Math.floor(Math.random() * potentialEnemies.length)] : ALL_CARDS[Math.floor(Math.random() * ALL_CARDS.length)];
                    enemyTeam.push({ ...base, currentHp: base.hp, level: 0 });
                }
                const myMaxHp = myTeam.reduce((sum, c) => sum + c.hp, 0);
                const myTotalPower = myTeam.reduce((sum, c) => sum + c.power, 0);
                const enMaxHp = enemyTeam.reduce((sum, c) => sum + c.hp, 0);
                const enTotalPower = enemyTeam.reduce((sum, c) => sum + c.power, 0);
                setBattleState({ myTeam, enemyTeam, myHp: myMaxHp, myMaxHp, myPower: myTotalPower, enHp: enMaxHp, enMaxHp, enPower: enTotalPower, turn: 0, logs: [], phase: 'PLAYER_TURN' });
                setView('BATTLE');
                updateMission('BATTLE_COUNT');
            };

            const startTimingRound = () => { setIsBattleTiming(true); };
            const resolveTiming = (multiplier) => { setIsBattleTiming(false); executePlayerAttack(multiplier); };
            const executePlayerAttack = (multiplier) => {
                if (!battleState) return;
                const damage = Math.floor(battleState.myPower * multiplier);
                const newEnHp = Math.max(0, battleState.enHp - damage);
                setDamageAnim({ active: true, target: 'ENEMY', value: damage });
                setTimeout(() => setDamageAnim({ active: false, target: null, value: 0 }), 1000);
                const newLogs = [...battleState.logs, `Âë≥ÊñπÊîªÊíÉ: ${damage}„ÉÄ„É° (x${multiplier.toFixed(1)})`];
                if (newEnHp === 0) {
                    setTimeout(() => {
                        setBattleState(prev => ({ ...prev, enHp: newEnHp, finished: true, won: true, reward: 1000, logs: [...newLogs, "WIN!"] }));
                        setCoins(prev => prev + 1000);
                        updateMission('BATTLE_WIN');
                    }, 1000);
                } else {
                    setBattleState(prev => ({ ...prev, enHp: newEnHp, logs: newLogs, phase: 'ENEMY_TURN' }));
                    setTimeout(executeEnemyAttack, 1500);
                }
            };
            const executeEnemyAttack = () => {
                setBattleState(prev => {
                    if (prev.finished) return prev;
                    const variance = 0.9 + Math.random() * 0.2;
                    const damage = Math.floor(prev.enPower * variance);
                    const newMyHp = Math.max(0, prev.myHp - damage);
                    const newLogs = [...prev.logs, `ÊïµÊîªÊíÉ: ${damage}„ÉÄ„É°`];
                    if (newMyHp === 0) {
                        setCoins(c => c + 50);
                        return { ...prev, myHp: newMyHp, logs: [...newLogs, "LOSE..."], finished: true, won: false, reward: 50 };
                    } else {
                        return { ...prev, myHp: newMyHp, logs: newLogs, phase: 'PLAYER_TURN' };
                    }
                });
            };

            const renderDeckSelect = () => {
                const myIds = Object.keys(collection).filter(id => collection[id] > 0);
                const ownedCards = ALL_CARDS.filter(c => myIds.includes(String(c.id))).sort((a,b) => b.power - a.power);
                return (
                    <div className="flex flex-col h-full animate-in fade-in scroll-container">
                        <div className="flex justify-between items-center mb-4 shrink-0">
                            <Button onClick={() => setView('HOME')} variant="secondary" size="small"><Icons.RotateCcw size={16}/> Êàª„Çã</Button>
                            <h2 className="text-xl font-bold text-white">„Éá„ÉÉ„Ç≠Á∑®Êàê (3‰Ωì)</h2>
                            <Button onClick={autoSelectDeck} variant="gold" size="small">„Åä„Åæ„Åã„Åõ</Button>
                        </div>
                        <div className="flex justify-center gap-2 mb-4 min-h-[120px] bg-gray-800/50 p-2 rounded-lg border border-dashed border-gray-600">
                            {selectedDeck.map((card, idx) => (
                                <div key={idx} className="relative cursor-pointer hover:scale-95 transition-transform" onClick={() => setSelectedDeck(prev => prev.filter((_, i) => i !== idx))}>
                                    <Card card={card} size="small" isRental={card.isRental} level={cardLevels[card.id] || 0} />
                                    <div className="absolute -top-2 -right-2 bg-red-500 rounded-full p-1 shadow"><Icons.X size={12} /></div>
                                </div>
                            ))}
                            {selectedDeck.length < 3 && Array(3 - selectedDeck.length).fill(0).map((_, i) => (
                                <div key={i} className="w-24 h-32 bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex items-center justify-center text-gray-500 text-xs">ÈÅ∏ÊäûÂæÖ„Å°</div>
                            ))}
                        </div>
                        <div className="flex justify-center mb-4"><Button onClick={confirmDeckAndStart} variant="danger" disabled={selectedDeck.length !== 3} className="px-12 py-3 text-xl shadow-lg w-full max-w-sm">„Éê„Éà„É´ÈñãÂßãÔºÅ</Button></div>
                        <div className="flex-1 overflow-y-auto pb-32 scroll-container"><div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">{ownedCards.map(card => { const isSelected = selectedDeck.some(c => c.id === card.id); return (<div key={card.id} className="relative"><Card card={card} size="small" onClick={() => toggleDeckCard(card)} isSelected={isSelected} level={cardLevels[card.id] || 0} /><div className="absolute top-0 right-0 bg-blue-600 text-[10px] px-1 rounded-bl">x{collection[card.id]}</div></div>); })}</div></div>
                    </div>
                );
            };

            const renderBattleView = () => {
                if (!battleState) return null;
                if (isBattleTiming) return <BattleTimer onComplete={resolveTiming} />;
                if (battleState.finished) {
                    return (
                        <div className="flex flex-col items-center justify-center h-full space-y-6 animate-in zoom-in">
                            <h2 className={`text-5xl font-black ${battleState.won ? 'text-yellow-400' : 'text-gray-500'}`}>{battleState.won ? 'VICTORY' : 'DEFEAT'}</h2>
                            <div className="text-2xl text-white">Â†±ÈÖ¨: <span className="text-yellow-400 font-bold">+{battleState.reward} G</span></div>
                            <Button onClick={() => setView('HOME')} variant="primary" className="px-8 py-3 text-lg">„Éõ„Éº„É†„Å∏Êàª„Çã</Button>
                        </div>
                    );
                }
                const myHpPercent = (battleState.myHp / battleState.myMaxHp) * 100;
                const enHpPercent = (battleState.enHp / battleState.enMaxHp) * 100;
                return (
                    <div className="h-full flex flex-col relative overflow-hidden">
                        <div className="flex justify-between items-center mb-2 bg-black/30 p-2 rounded shrink-0">
                            <div className="text-white font-bold flex items-center gap-2"><Icons.Swords size={16}/> „ÉÅ„Éº„É†Êà¶</div>
                            <div className={`font-bold ${battleState.phase === 'PLAYER_TURN' ? 'text-blue-400 animate-pulse' : 'text-red-400'}`}>{battleState.phase === 'PLAYER_TURN' ? "„ÅÇ„Å™„Åü„ÅÆ„Çø„Éº„É≥" : "Áõ∏Êâã„ÅÆ„Çø„Éº„É≥..."}</div>
                        </div>
                        <div className="flex-1 flex flex-col justify-center gap-4 relative z-10 p-2">
                            <div className="flex flex-col items-center gap-2">
                                <div className="w-full max-w-md bg-gray-800 h-3 rounded-full border border-gray-600 relative overflow-hidden"><div className="absolute top-0 left-0 h-full bg-red-500 transition-all duration-500" style={{width: `${enHpPercent}%`}}></div></div>
                                <div className={`flex justify-center -space-x-4 transition-transform duration-300 ${damageAnim.active && damageAnim.target === 'ENEMY' ? 'animate-shake' : ''}`}>
                                    {battleState.enemyTeam.map((c, i) => <div key={i} className="transform scale-75 md:scale-100"><Card card={c} size="small" showPower={false} /></div>)}
                                </div>
                                {damageAnim.active && damageAnim.target === 'ENEMY' && <div className="absolute top-1/4 text-red-500 font-black text-6xl animate-damage" style={{textShadow:'2px 2px 0 #000'}}>-{damageAnim.value}</div>}
                            </div>
                            <div className="flex justify-center items-center gap-4 text-xs font-mono text-gray-400"><div className="text-red-400">POW: {battleState.enPower}</div><div className="font-black text-xl text-white/20 italic">VS</div><div className="text-blue-400">POW: {battleState.myPower}</div></div>
                            <div className="flex flex-col items-center gap-2">
                                <div className={`flex justify-center -space-x-2 transition-transform duration-300 ${damageAnim.active && damageAnim.target === 'PLAYER' ? 'animate-shake' : ''}`}>
                                    {battleState.myTeam.map((c, i) => <div key={i} className="transform scale-90 md:scale-100"><Card card={c} size="small" showPower={false} isRental={c.isRental} level={c.level} /></div>)}
                                </div>
                                <div className="w-full max-w-md bg-gray-800 h-4 rounded-full border border-gray-600 relative overflow-hidden mt-1"><div className="absolute top-0 left-0 h-full bg-blue-500 transition-all duration-500" style={{width: `${myHpPercent}%`}}></div><div className="absolute inset-0 flex items-center justify-center text-[10px] font-bold shadow-black drop-shadow-md">{battleState.myHp}/{battleState.myMaxHp}</div></div>
                            </div>
                        </div>
                        <div className="mt-2 flex justify-center pb-24 z-20 shrink-0 h-16">
                            {battleState.phase === 'PLAYER_TURN' && <Button onClick={startTimingRound} variant="danger" className="px-12 py-4 text-xl font-black shadow-lg animate-pulse">ATTACK!</Button>}
                            {battleState.phase === 'ENEMY_TURN' && <div className="text-red-400 font-bold animate-pulse">Áõ∏Êâã„ÅÆÊîªÊíÉ‰∏≠...</div>}
                        </div>
                    </div>
                );
            };

            const renderCollection = () => {
                const sortedCards = [...ALL_CARDS].sort((a, b) => {
                    const aOwned = collection[a.id] ? 1 : 0;
                    const bOwned = collection[b.id] ? 1 : 0;
                    if (aOwned !== bOwned) return bOwned - aOwned;
                    return a.id - b.id;
                });
                return (
                    <div className="h-full flex flex-col relative">
                        <div className="flex justify-between items-center mb-4 shrink-0">
                            <Button onClick={() => setView('HOME')} variant="secondary" size="small"><Icons.RotateCcw size={16} /> Êàª„Çã</Button>
                            <div className="text-right text-xs text-gray-400">Ë©≥Á¥∞„ÉªË¶öÈÜí</div>
                        </div>
                        <div className="flex-1 overflow-y-auto pb-32 scroll-container">
                            <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
                                {sortedCards.map(card => {
                                    const count = collection[card.id] || 0;
                                    return (
                                        <div key={card.id} className="relative group">
                                            <Card card={card} isHidden={count === 0} size="small" onClick={() => count > 0 && setSelectedCard(card)} level={cardLevels[card.id] || 0} />
                                            {count > 0 && <div className="absolute top-0 right-0 bg-blue-600 text-white text-[10px] px-1 rounded-bl opacity-90 z-10">x{count}</div>}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderHome = () => (
                <div className="flex flex-col items-center justify-center h-full space-y-6 animate-fadeIn relative pb-safe">
                    <div className="absolute top-4 right-4"><button onClick={() => setShowMissions(true)} className="bg-gray-800 p-2 rounded-full border border-green-500 text-green-400 hover:bg-gray-700 relative flex items-center gap-2"><Icons.Calendar size={18}/><span className="text-xs font-bold">„ÇØ„Ç®„Çπ„Éà</span></button></div>
                    <div className="text-center space-y-2"><h1 className="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 filter drop-shadow-lg">ANIMAL<br/>CHRONICLE</h1><p className="text-gray-400 text-sm">Á©∂Ê•µ„ÅÆÁîüÊÖãÁ≥ª„ÇíÁØâ„Åç‰∏ä„Åí„Çç</p></div>
                    <div className="w-full max-w-md bg-gray-800 rounded-full h-12 border border-gray-600 relative overflow-hidden flex items-center px-4 cursor-pointer group" onClick={() => setView('GACHA')}><div className="absolute left-0 top-0 bottom-0 bg-gradient-to-r from-blue-900 to-blue-600 transition-all duration-300" style={{width: `${freePackProgress}%`}}></div><div className="absolute left-0 top-0 bottom-0 w-full flex items-center justify-between px-4 z-10"><div className="flex items-center gap-2 font-bold text-white drop-shadow-md"><Icons.Timer size={20}/>{freePackProgress >= 100 ? "FREE PACK READY!" : "„Éë„ÉØ„ÉºÂÖÖÂ°´‰∏≠..."}</div><div className="text-xs font-mono text-white/80">{freePackProgress >= 100 ? "100%" : `„ÅÇ„Å® ${timeUntilFreePack}`}</div></div></div>
                    <div className="grid grid-cols-2 gap-4 w-full max-w-md"><div className="bg-gray-800 p-3 rounded-xl border border-gray-700 flex flex-col items-center justify-center text-center"><span className="text-gray-400 text-xs mb-1">COLLECTION</span><span className="text-2xl font-bold text-white">{Object.keys(collection).length} / {ALL_CARDS.length}</span></div><div className="bg-gray-800 p-3 rounded-xl border border-gray-700 flex flex-col items-center justify-center text-center"><span className="text-gray-400 text-xs mb-1">MONEY</span><span className="text-2xl font-bold text-yellow-400 flex items-center gap-1"><Icons.Coins size={20} /> {coins}</span></div></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 w-full max-w-lg px-4">
                        <Button onClick={() => setView('GACHA')} variant="gold" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Sparkles /> „Çπ„Ç´„Ç¶„Éà</div></Button>
                        <Button onClick={() => { setView('DECK_SELECT'); setSelectedDeck([]); }} variant="danger" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Zap /> „Éê„Éà„É´</div></Button>
                        <Button onClick={() => { setView('MARKET'); refreshShop(); createAuction(); updateMission('VISIT_MARKET'); }} variant="green" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.ShoppingBag /> „Éû„Éº„Ç±„ÉÉ„Éà</div></Button>
                        <Button onClick={() => setView('COLLECTION')} variant="primary" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Search /> „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥</div></Button>
                    </div>
                </div>
            );

            const renderGacha = () => (
                <div className="flex flex-col items-center h-full relative">
                    <div className="w-full flex justify-between items-center mb-6"><Button onClick={() => { setView('HOME'); setPackResult(null); setPackState('IDLE'); }} variant="secondary" size="small"><Icons.RotateCcw size={16} /> Êàª„Çã</Button><div className="bg-gray-800 px-4 py-2 rounded-full border border-yellow-600 text-yellow-400 font-bold">{coins} G</div></div>
                    {packState === 'IDLE' && <div className="flex-1 flex flex-col items-center justify-center space-y-8 w-full max-w-md animate-in fade-in"><Button onClick={() => openPack(1, true)} variant="primary" className="w-full mt-2 z-10" disabled={freePackProgress < 100}>{freePackProgress >= 100 ? "‚ú® ÁÑ°Êñô„ÅßÈñãÂ∞ÅÔºÅ ‚ú®" : `„ÉÅ„É£„Éº„Ç∏‰∏≠...`}</Button><div className="flex flex-col gap-2 w-full"><Button onClick={() => openPack(1)} variant="gold" disabled={coins < 500} className="w-full py-4 justify-between text-lg"><span>1„Éë„ÉÉ„ÇØ (5Êûö)</span><span>500 G</span></Button><Button onClick={() => openPack(10)} variant="gold" disabled={coins < 5000} className="w-full py-4 justify-between border border-white/20 text-lg"><span>10„Éë„ÉÉ„ÇØ (50Êûö)</span><span>5,000 G</span></Button></div></div>}
                    {packState === 'SHOW_PACK' && <PackOpener onOpen={finishPackOpening} />}
                    {packState === 'SHOW_RESULTS' && pendingPackCards && <div className="flex-1 flex flex-col items-center w-full overflow-hidden"><div className="flex-1 overflow-y-auto w-full px-4 pb-32 scroll-container"><div className="flex flex-wrap justify-center gap-3">{pendingPackCards.map((card, idx) => (<div key={idx} className="animate-in zoom-in duration-300" style={{animationDelay: `${idx * 100}ms`}}><Card card={card} isNew={collection[card.id] === 1} size="small" /></div>))}</div></div><div className="mt-4 pb-safe flex gap-4 shrink-0"><Button onClick={() => { setPackState('IDLE'); setPendingPackCards(null); }} variant="secondary">Èñâ„Åò„Çã</Button></div></div>}
                </div>
            );

            const renderMarket = () => (
                <div className="h-full flex flex-col"><div className="flex justify-between items-center mb-4 shrink-0"><Button onClick={() => setView('HOME')} variant="secondary" size="small"><Icons.RotateCcw size={16} /> Êàª„Çã</Button><div className="bg-gray-800 px-4 py-1 rounded-full border border-yellow-600 text-yellow-400 font-bold flex items-center gap-2"><Icons.Coins size={16} /> {coins} G</div></div><div className="flex gap-2 mb-4 bg-gray-800 p-1 rounded-lg shrink-0"><button onClick={() => setMarketTab('SHOP')} className={`flex-1 py-2 rounded font-bold transition-colors ${marketTab === 'SHOP' ? 'bg-emerald-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>„Ç∑„Éß„ÉÉ„Éó</button><button onClick={() => setMarketTab('AUCTION')} className={`flex-1 py-2 rounded font-bold transition-colors ${marketTab === 'AUCTION' ? 'bg-orange-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>„Ç™„Éº„ÇØ„Ç∑„Éß„É≥</button></div><div className="flex-1 overflow-y-auto pb-32 scroll-container">{marketTab === 'SHOP' && <div className="grid grid-cols-2 md:grid-cols-3 gap-4">{shopItems.map(card => (<div key={card.id} className="flex flex-col gap-2"><Card card={card} size="small" className="mx-auto" /><Button onClick={() => buyShopItem(card)} variant="secondary" className="text-sm py-1">Ë≥ºÂÖ• {RARITY_CONFIG[card.rarity].buy} G</Button></div>))}</div>}{marketTab === 'AUCTION' && <div className="space-y-4"><div className="flex justify-end"><Button onClick={createAuction} variant="primary" className="text-xs">Êé¢Á¥¢</Button></div>{auctionItems.map(item => (<div key={item.id} className="bg-gray-800 p-4 rounded-lg border border-gray-600 flex gap-4 items-center"><Card card={item.card} size="small" /><div className="flex-1 min-w-0"><h3 className="font-bold truncate">{item.card.name}</h3><div className="text-yellow-400 font-bold">{item.currentBid} G</div>{item.endTime <= Date.now() ? (item.lastBidder === 'YOU' ? <Button onClick={() => claimAuction(item)} variant="green">ÂèóÂèñ</Button> : <div>ÁµÇ‰∫Ü</div>) : <Button onClick={() => placeBid(item.id, item.currentBid)} variant="gold">ÂÖ•Êú≠</Button>}</div></div>))}</div>}</div></div>
            );

            return (
                <div className="w-full h-full bg-slate-900 relative shadow-2xl overflow-hidden flex flex-col font-sans">
                    {/* Backgrounds */}
                    <div className="absolute inset-0 z-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_50%_50%,_rgba(76,29,149,0.5),_rgba(15,23,42,1))]"></div>
                    
                    <div className="relative z-10 flex-1 p-4 overflow-hidden">
                        {view === 'HOME' && renderHome()}
                        {view === 'GACHA' && renderGacha()}
                        {view === 'COLLECTION' && renderCollection()}
                        {view === 'DECK_SELECT' && renderDeckSelect()}
                        {view === 'BATTLE' && renderBattleView()}
                        {view === 'MARKET' && renderMarket()}
                    </div>

                    {/* Missions Modal */}
                    {showMissions && (
                        <div className="fixed inset-0 bg-black/80 z-[9998] flex items-center justify-center p-4 animate-in fade-in" onClick={() => setShowMissions(false)}>
                            <div className="bg-gray-800 w-full max-w-md rounded-xl border border-gray-600 p-6 shadow-2xl" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold flex items-center gap-2"><Icons.Calendar className="text-orange-400" /> ‰ªäÊó•„ÅÆ„ÇØ„Ç®„Çπ„Éà</h2>
                                    <button onClick={() => setShowMissions(false)}><Icons.X /></button>
                                </div>
                                <div className="space-y-3">
                                    {activeMissions.map(m => {
                                        const current = missionProgress[m.id] || 0;
                                        const isDone = current >= m.target;
                                        const isClaimed = claimedMissions.includes(m.id);
                                        return (
                                            <div key={m.id} className="bg-gray-900 p-3 rounded border border-gray-700 flex justify-between items-center">
                                                <div><div className="font-bold text-sm">{m.text}</div><div className="text-xs text-gray-400">ÈÄ≤Êçó: {Math.min(current, m.target)} / {m.target}</div></div>
                                                <div>{isClaimed ? <span className="text-gray-500 text-xs font-bold px-3 py-1 border border-gray-600 rounded">ÂèóÂèñÊ∏à</span> : isDone ? <Button onClick={() => claimMission(m)} variant="gold" size="small" className="text-xs py-1">ÂèóÂèñ {m.reward}G</Button> : <span className="text-gray-600 text-xs px-2">Êú™ÈÅîÊàê</span>}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Card Detail Modal */}
                    {selectedCard && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-[9999] flex flex-col items-center justify-center p-4 animate-in zoom-in" onClick={() => setSelectedCard(null)}>
                            <div className="bg-gray-800 p-6 rounded-xl border border-gray-600 max-w-sm w-full flex flex-col items-center shadow-2xl" onClick={e => e.stopPropagation()}>
                                <div className="flex w-full justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-white">„Ç´„Éº„ÉâË©≥Á¥∞</h3>
                                    <button onClick={() => setSelectedCard(null)} className="text-gray-400 hover:text-white"><Icons.X /></button>
                                </div>
                                <Card card={selectedCard} showPower={true} level={cardLevels[selectedCard.id] || 0} />
                                
                                <div className="w-full mt-6 space-y-4">
                                    <div className="grid grid-cols-2 gap-3 w-full">
                                        <div className="text-center bg-gray-900 p-2 rounded"><div className="text-xs text-gray-500">ÊâÄÊúâÊï∞</div><div className="text-xl font-bold text-white">{collection[selectedCard.id]}Êûö</div></div>
                                        <div className="text-center bg-gray-900 p-2 rounded"><div className="text-xs text-gray-500">Â£≤Âç¥‰æ°Ê†º</div><div className="text-xl font-bold text-yellow-400">{RARITY_CONFIG[selectedCard.rarity].sell} G</div></div>
                                    </div>
                                    {collection[selectedCard.id] >= 3 && (
                                        <div className="bg-yellow-900/30 p-3 rounded border border-yellow-600/50 text-center">
                                            <div className="text-xs text-yellow-200 mb-1">Ë¶öÈÜíÂèØËÉΩÔºÅ(3ÊûöÊ∂àË≤ª)</div>
                                            <Button onClick={() => levelUpCard(selectedCard)} variant="gold" className="w-full text-sm">Ë¶öÈÜí (Lv.{ (cardLevels[selectedCard.id] || 0) + 1 } &rarr; { (cardLevels[selectedCard.id] || 0) + 2 })</Button>
                                        </div>
                                    )}
                                    <Button onClick={() => sellCard(selectedCard)} variant="secondary" className="w-full border-red-900 hover:bg-red-900/50 text-red-300" disabled={collection[selectedCard.id] <= 0}>Â£≤Âç¥„Åó„Å¶„Ç≥„Ç§„É≥„Å´„Åô„Çã</Button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Login Bonus Modal */}
                    {loginBonus && (
                        <div className="fixed inset-0 bg-black/90 z-[10000] flex items-center justify-center p-4 animate-in zoom-in">
                            <div className="bg-gradient-to-b from-yellow-600 to-yellow-800 p-8 rounded-2xl border-4 border-yellow-400 text-center max-w-sm w-full shadow-2xl">
                                <h2 className="text-3xl font-black text-white mb-4 drop-shadow-md">LOGIN BONUS!</h2>
                                <div className="text-6xl mb-6 animate-bounce">üéÅ</div>
                                <div className="text-2xl font-bold text-white mb-8"><span className="text-yellow-200">{loginBonus}</span> G GET!</div>
                                <Button onClick={() => { setCoins(c => c + loginBonus); setLoginBonus(null); }} variant="gold" className="w-full py-4 text-xl shadow-xl">Âèó„ÅëÂèñ„Çã</Button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AnimalChronicle />);
    </script>
</body>
</html>
