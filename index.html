<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Ç¢„Éã„Éû„É´„Éª„ÇØ„É≠„Éã„ÇØ„É´ 5150 - Ver.2.1</title>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animations */
        @keyframes shimmer { 0% { transform: translateX(-150%) skewX(-15deg); } 100% { transform: translateX(150%) skewX(-15deg); } }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-5deg); } 75% { transform: translateX(5px) rotate(5deg); } }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        @keyframes float-up { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-50px) scale(1.5); opacity: 0; } }
        .animate-damage { animation: float-up 1s forwards ease-out; }
        
        /* Reel Animation */
        @keyframes reel-spin { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }
        .reel-spinning { animation: reel-spin 0.2s linear infinite; }

        /* UI Utilities */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        body { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .text-shadow { text-shadow: 2px 2px 0 #000; }
    </style>
</head>
<body class="bg-gray-950 text-white h-[100dvh] w-screen overflow-hidden font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- ICONS ---
        const IconBase = ({ children, className, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Icons = {
            Sparkles: (p) => <IconBase {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></IconBase>,
            Trophy: (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>,
            Zap: (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>,
            Search: (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>,
            RotateCcw: (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>,
            Coins: (p) => <IconBase {...p}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/></IconBase>,
            Scissors: (p) => <IconBase {...p}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" x2="8.12" y1="4" y2="15.88"/><line x1="14.47" x2="20" y1="14.48" y2="20"/><line x1="8.12" x2="12" y1="8.12" y2="12"/></IconBase>,
            CheckCircle: (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>,
            ChevronLeft: (p) => <IconBase {...p}><path d="m15 18-6-6 6-6"/></IconBase>,
            ChevronRight: (p) => <IconBase {...p}><path d="m9 18 6-6-6-6"/></IconBase>,
            Home: (p) => <IconBase {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>,
            Play: (p) => <IconBase {...p}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>,
            StopCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><rect x="9" y="9" width="6" height="6"/></IconBase>,
            Box: (p) => <IconBase {...p}><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></IconBase>,
        };

        // --- DATA ---
        const RARITY_CONFIG = {
            GOD: { color: 'from-indigo-900 via-purple-900 to-pink-900', border: 'border-yellow-400', text: 'text-yellow-300', probability: 0.001, powerBase: 9500, hpBase: 33000, cost: 10, sell: 5000, buy: 50000 },
            LEGEND: { color: 'from-yellow-700 to-yellow-900', border: 'border-yellow-500', text: 'text-yellow-400', probability: 0.009, powerBase: 8000, hpBase: 28000, cost: 8, sell: 2000, buy: 12000 },
            ULTIMATE: { color: 'from-red-800 to-red-950', border: 'border-red-500', text: 'text-red-400', probability: 0.04, powerBase: 6500, hpBase: 22000, cost: 6, sell: 800, buy: 5000 },
            EPIC: { color: 'from-purple-800 to-indigo-900', border: 'border-purple-400', text: 'text-purple-300', probability: 0.10, powerBase: 4500, hpBase: 15000, cost: 5, sell: 300, buy: 2000 },
            RARE: { color: 'from-blue-700 to-blue-900', border: 'border-blue-400', text: 'text-blue-300', probability: 0.25, powerBase: 2500, hpBase: 8500, cost: 3, sell: 100, buy: 800 },
            COMMON: { color: 'from-slate-600 to-slate-800', border: 'border-slate-400', text: 'text-slate-300', probability: 0.60, powerBase: 1000, hpBase: 3500, cost: 1, sell: 10, buy: 200 }
        };

        const VARIANT_CONFIG = {
            1: { id: 1, name: "NORMAL", suffix: "", chance: 0.80, powMod: 1.0, hpMod: 1.0, colorClass: "" },
            2: { id: 2, name: "SECRET", suffix: "(„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà)", chance: 0.001, powMod: 1.5, hpMod: 1.5, colorClass: "ring-4 ring-yellow-300 shadow-[0_0_15px_gold] bg-yellow-900/30" },
            3: { id: 3, name: "LAVA", suffix: "LAVA", chance: 0.025, powMod: 1.2, hpMod: 1.0, colorClass: "ring-2 ring-red-500 shadow-[0_0_10px_red] bg-red-900/20" },
            4: { id: 4, name: "DIVER", suffix: "DIVER", chance: 0.025, powMod: 1.0, hpMod: 1.2, colorClass: "ring-2 ring-blue-400 shadow-[0_0_10px_cyan] bg-blue-900/20" },
            5: { id: 5, name: "MECHA", suffix: "Mk-II", chance: 0.025, powMod: 1.1, hpMod: 1.1, colorClass: "ring-2 ring-gray-300 shadow-[0_0_10px_silver] bg-gray-800/50" },
            6: { id: 6, name: "SHADOW", suffix: "SHADOW", chance: 0.025, powMod: 1.3, hpMod: 0.8, colorClass: "ring-2 ring-purple-900 shadow-[0_0_10px_black] grayscale" },
            7: { id: 7, name: "VENOM", suffix: "VENOM", chance: 0.025, powMod: 0.9, hpMod: 1.3, colorClass: "ring-2 ring-purple-500 shadow-[0_0_10px_purple] bg-purple-900/20" },
            8: { id: 8, name: "FROZEN", suffix: "FROZEN", chance: 0.025, powMod: 1.05, hpMod: 1.15, colorClass: "ring-2 ring-cyan-300 shadow-[0_0_10px_white] bg-cyan-900/20" },
            9: { id: 9, name: "THUNDER", suffix: "THUNDER", chance: 0.025, powMod: 1.25, hpMod: 0.9, colorClass: "ring-2 ring-yellow-400 shadow-[0_0_10px_yellow] bg-yellow-900/20" },
            10: { id: 10, name: "CRYSTAL", suffix: "CRYSTAL", chance: 0.024, powMod: 1.1, hpMod: 1.2, colorClass: "ring-2 ring-pink-300 shadow-[0_0_10px_pink] bg-pink-900/20" },
        };

        const PACK_TYPES = [
            { id: 'NORMAL', name: '„Éé„Éº„Éû„É´„Éë„ÉÉ„ÇØ', price: 500, desc: 'Âü∫Êú¨ÁöÑ„Å™„Éë„ÉÉ„ÇØ„ÄÇÈÅãË©¶„Åó„Å´„ÄÇ', color: 'from-slate-700 to-slate-900', borderColor: 'border-slate-500' },
            { id: 'LAVA', name: 'Ê∫∂Â≤©„Éë„ÉÉ„ÇØ', price: 1000, desc: 'LAVAÂ±ûÊÄß„ÅåÂá∫„ÇÑ„Åô„ÅÑÔºÅ(50%)', color: 'from-red-900 to-orange-900', borderColor: 'border-red-500', variantRate: { 3: 0.5 } },
            { id: 'FROZEN', name: 'Ê∞∑Áµê„Éë„ÉÉ„ÇØ', price: 1000, desc: 'FROZENÂ±ûÊÄß„ÅåÂá∫„ÇÑ„Åô„ÅÑÔºÅ(50%)', color: 'from-cyan-900 to-blue-900', borderColor: 'border-cyan-400', variantRate: { 8: 0.5 } },
            { id: 'THUNDER', name: 'Èõ∑È≥¥„Éë„ÉÉ„ÇØ', price: 1200, desc: 'THUNDERÂ±ûÊÄß„ÅåÂá∫„ÇÑ„Åô„ÅÑÔºÅ(50%)', color: 'from-yellow-900 to-amber-900', borderColor: 'border-yellow-400', variantRate: { 9: 0.5 } },
            { id: 'MECHA', name: 'Ê©üÊ¢∞‰ªïÊéõ„Åë„ÅÆ„Éë„ÉÉ„ÇØ', price: 1500, desc: 'MECHAÂ±ûÊÄß„ÅåÂá∫„ÇÑ„Åô„ÅÑÔºÅ(50%)', color: 'from-gray-800 to-zinc-800', borderColor: 'border-gray-400', variantRate: { 5: 0.5 } },
            { id: 'SHADOW', name: 'ÊöóÈªí„Éë„ÉÉ„ÇØ', price: 2000, desc: 'SHADOWÂ±ûÊÄß„ÅåÂá∫„ÇÑ„Åô„ÅÑÔºÅ(50%)', color: 'from-purple-900 to-black', borderColor: 'border-purple-600', variantRate: { 6: 0.5 } },
            { id: 'SECRET', name: 'Êé¢Ê±ÇËÄÖ„Éë„ÉÉ„ÇØ', price: 3000, desc: '„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà(SECRET)Á¢∫Áéá5ÂÄçÔºÅ', color: 'from-indigo-900 to-slate-900', borderColor: 'border-indigo-400', secretMult: 5.0 },
            { id: 'RARE_PLUS', name: '„É¨„Ç¢‰ª•‰∏äÁ¢∫ÂÆö„Éë„ÉÉ„ÇØ', price: 5000, desc: 'RARE‰ª•‰∏ä„ÅåÂøÖ„ÅöÂá∫ÁèæÔºÅ', color: 'from-blue-800 to-blue-950', borderColor: 'border-blue-400', minRarity: 'RARE' },
            { id: 'ULTIMATE', name: 'Á©∂Ê•µ„Éë„ÉÉ„ÇØ', price: 30000, desc: 'ULTIMATE‰ª•‰∏äÁ¢∫ÂÆöÔºÅ', color: 'from-red-800 to-rose-950', borderColor: 'border-rose-500', minRarity: 'ULTIMATE' },
            { id: 'GOD_OMEGA', name: '„Ç™„É°„Ç¨„Éë„ÉÉ„ÇØ', price: 100000, desc: 'GODÁ¢∫Áéá10ÂÄç(1%) & LEGEND‰ª•‰∏äÁ¢∫ÂÆöÔºÅ', color: 'from-yellow-700 via-purple-800 to-black', borderColor: 'border-yellow-300', minRarity: 'LEGEND', godMult: 10.0 },
        ];

        const ANIMAL_EMOJIS = {
            "„É©„Ç§„Ç™„É≥": "ü¶Å", "„Éâ„É©„Ç¥„É≥": "üêâ", "„ÇØ„Ç∏„É©": "üêã", "„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ": "ü¶Ö", "„ÇØ„É©„Éº„Ç±„É≥": "ü¶ë", "„Ç∞„É™„Éï„Ç©„É≥": "ü¶Ö", "„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ": "ü¶ñ", "„Éû„É≥„É¢„Çπ": "ü¶£", "„Çµ„É©„Éû„É≥„ÉÄ„Éº": "ü¶é", "„Éö„Ç¨„Çµ„Çπ": "ü¶Ñ", "„Éí„Éâ„É©": "üêç", "Áãê": "ü¶ä", "„Çπ„Éï„Ç£„É≥„ÇØ„Çπ": "üóø", "„Ç¥„É™„É©": "ü¶ç", "„Çµ„É°": "ü¶à", "„Éö„É≥„ÇÆ„É≥": "üêß", "„Çµ„Ç§": "ü¶è", "„Ç´„Éû„Ç≠„É™": "ü¶ó", "„Çπ„Ç≥„Éº„Éî„Ç™„É≥": "ü¶Ç", "„Éè„É§„Éñ„Çµ": "ü¶Ö", "„Ç¢„Éä„Ç≥„É≥„ÉÄ": "üêç", "„Çø„Ç§„Ç¨„Éº": "üêØ", "„Éô„Ç¢": "üêª", "„ÇØ„É≠„Ç≥„ÉÄ„Ç§„É´": "üêä", "„Ç§„Éº„É´": "üêü", "„Éï„É≠„ÉÉ„Ç∞": "üê∏", "„Ç´„Éñ„Éà„É†„Ç∑": "ü™≤", "„Ç§„Éº„Ç∞„É´": "ü¶Ö", "„É†„Çµ„Çµ„Éì": "üêøÔ∏è", "„Ç´„É°„É¨„Ç™„É≥": "ü¶é", "„Ç¢„É´„Éû„Ç∏„É≠": "ü¶î", "„Ç≥„Ç¶„É¢„É™": "ü¶á", "„Ç™„Ç™„Ç´„Éü": "üê∫", "„Çæ„Ç¶": "üêò", "„ÉÅ„Éº„Çø„Éº": "üêÜ", "„Éí„Éß„Ç¶": "üêÜ", "„Ç∏„É£„Ç¨„Éº": "üêÜ", "„Ç´„Éê": "ü¶õ", "„Ç≠„É™„É≥": "ü¶í", "„Éê„ÉÉ„Éï„Ç°„É≠„Éº": "üêÉ", "„Ç§„Éé„Ç∑„Ç∑": "üêó", "„Ç´„É≥„Ç¨„É´„Éº": "ü¶ò", "„Éà„Ç´„Ç≤": "ü¶é", "„ÉØ„Éã": "üêä", "„Éò„Éì": "üêç", "„Ç≥„Éñ„É©": "üêç", "„ÉØ„Ç∑": "ü¶Ö", "„Ç≥„É≥„Éâ„É´": "ü¶Ö", "„Éï„ÇØ„É≠„Ç¶": "ü¶â", "„ÉÄ„ÉÅ„Éß„Ç¶": "üê¶", "„Ç∑„É£„ÉÅ": "üê¨", "„Ç§„Ç´": "ü¶ë", "„Ç®„Ç§": "üêü", "„Éî„É©„Éã„Ç¢": "üêü", "„Çπ„Ç∫„É°„Éê„ÉÅ": "üêù", "„ÇØ„ÉØ„Ç¨„Çø": "ü™≤", "„Éà„É≥„Éú": "ü™Å", "„ÇØ„É¢": "üï∑Ô∏è", "„É†„Ç´„Éá": "üêõ", "„Éë„É≥„ÉÄ": "üêº", "„Çµ„É´": "üêí", "„Ç™„É©„É≥„Ç¶„Éº„Çø„É≥": "ü¶ß", "„Éè„É†„Çπ„Çø„Éº": "üêπ", "„Éç„Ç∫„Éü": "üê≠", "„É™„Çπ": "üêøÔ∏è", "„Ç¶„Çµ„ÇÆ": "üê∞", "„Éç„Ç≥": "üê±", "„Ç§„Éå": "üê∂", "„Ç¶„Éû": "üê¥", "„Ç¶„Ç∑": "üêÆ", "„Éñ„Çø": "üê∑", "„Éí„ÉÑ„Ç∏": "üêë", "„É§„ÇÆ": "üêê", "„Éà„É™": "üêî", "„Éã„ÉØ„Éà„É™": "üêî", "„Éí„É®„Ç≥": "üê•", "„Ç´„É¢": "ü¶Ü", "„ÉÑ„É´": "ü¶¢", "„Éè„Éà": "üïäÔ∏è", "„Ç´„É©„Çπ": "üê¶‚Äç‚¨õ", "„Ç§„É≥„Ç≥": "ü¶ú", "„Ç™„Ç¶„É†": "ü¶ú", "„Ç´„Ç®„É´": "üê∏", "„Ç´„É°": "üê¢", "„Çµ„Ç´„Éä": "üêü", "„Çø„Ç≥": "üêô", "„Ç®„Éì": "ü¶ê", "„Ç´„Éã": "ü¶Ä", "Ë≤ù": "üêö", "Ëô´": "üêõ", "„ÉÅ„Éß„Ç¶": "ü¶ã", "„Éè„ÉÅ": "üêù", "„ÉÜ„É≥„Éà„Ç¶„É†„Ç∑": "üêû", "„Ç¢„É™": "üêú", "„Éå„Éº": "üêÇ", "„É©„ÇØ„ÉÄ": "üê´", "„Ç¢„É´„Éë„Ç´": "ü¶ô", "„É©„Éû": "ü¶ô", "„É≠„Éê": "ü´è", "Êü¥Áä¨": "üêï", "„Éâ„Éº„Éô„É´„Éû„É≥": "üêï‚Äçü¶∫", "Âúü‰ΩêÁä¨": "üêï", "„Çª„É≥„Éà„Éê„Éº„Éä„Éº„Éâ": "üê∂", "„Éö„É´„Ç∑„É£Áå´": "üêà", "‰∏âÊØõÁå´": "üêà", "ÈªíÁå´": "üêà‚Äç‚¨õ", "„É§„Éû„Éç„Ç≥": "üê±", "„Ç¢„É©„Ç§„Ç∞„Éû": "ü¶ù", "„Çø„Éå„Ç≠": "üçÉ", "„Ç§„Çø„ÉÅ": "ü¶¶", "„Çπ„Ç´„É≥„ÇØ": "ü¶®", "„Éè„É™„Éç„Ç∫„Éü": "ü¶î", "„É§„Éû„Ç¢„É©„Ç∑": "ü¶î", "„É¢„Ç∞„É©": "üï≥Ô∏è", "„Éì„Éº„Éê„Éº": "ü¶´", "„Ç´„Éî„Éê„É©": "ü•î", "„Ç´„ÉØ„Ç¶„ÇΩ": "ü¶¶", "„É©„ÉÉ„Ç≥": "ü¶¶", "„Ç¢„Ç∂„É©„Ç∑": "ü¶≠", "„Ç¢„Ç∑„Ç´": "ü¶≠", "„Çª„Ç§„Ç¶„ÉÅ": "ü¶≠", "„Ç∏„É•„Ç¥„É≥": "üêã", "„Ç§„É´„Ç´": "üê¨", "„Éû„É≥„Éú„Ç¶": "üêü", "„Ç¢„É≥„Ç≥„Ç¶": "üî¶", "„Çø„ÉÑ„Éé„Ç™„Éà„Ç∑„Ç¥": "üêâ", "„Ç¶„Éü„Ç¨„É°": "üê¢", "„Éï„É©„Éü„É≥„Ç¥": "ü¶©", "„ÇØ„Ç∏„É£„ÇØ": "ü¶ö", "ÁôΩÈ≥•": "ü¶¢", "„Ç≠„Ç∏": "üê¶", "„Ç≠„ÉÑ„ÉÑ„Ç≠": "üê¶", "„Ç´„ÉØ„Çª„Éü": "üê¶", "„ÉÑ„Éê„É°": "üê¶", "„Éà„Éé„Çµ„Éû„Ç¨„Ç®„É´": "üê∏", "„Ç¢„Éû„Ç¨„Ç®„É´": "üê∏", "„Ç¶„Éº„Éë„Éº„É´„Éº„Éë„Éº": "ü¶é", "„Ç§„É¢„É™": "ü¶é", "„É§„É¢„É™": "ü¶é", "„É™„ÇØ„Ç¨„É°": "üê¢", "„É¢„É´„É¢„ÉÉ„Éà": "üêπ", "„ÉÅ„É≥„ÉÅ„É©": "üê≠", "„Éï„Çß„É¨„ÉÉ„Éà": "ü¶¶", "„Éè„ÉÑ„Ç´„Éç„Ç∫„Éü": "üêÅ", "„Çπ„Ç∫„É°": "üê¶", "ÈáëÈ≠ö": "üêü", "„Ç≥„Ç§": "üêü", "„É°„ÉÄ„Ç´": "üêü", "„Éâ„Ç∏„Éß„Ç¶": "üêü", "„Ç∂„É™„Ç¨„Éã": "ü¶û", "„Çµ„ÉØ„Ç¨„Éã": "ü¶Ä", "„É§„Éâ„Ç´„É™": "üêö", "„Ç¢„Çµ„É™": "üêö", "„Ç∑„Ç∏„Éü": "üêö", "„Ç´„Çø„ÉÑ„É†„É™": "üêå", "„Éä„É°„ÇØ„Ç∏": "üêå", "„Éü„Éü„Ç∫": "ü™±", "„Ç∑„É≠„Ç¢„É™": "üêú", "„Ç¢„Éñ„É©„É†„Ç∑": "üêõ", "„Ç¨": "ü¶ã", "„Éü„ÉÑ„Éê„ÉÅ": "üêù", "„Ç¢„Ç∑„Éä„Ç¨„Éê„ÉÅ": "üêù", "„Éè„Ç®": "ü™∞", "„Ç´": "ü¶ü", "„Ç¥„Ç≠„Éñ„É™": "ü™≥", "„Éé„Éü": "üêõ", "„ÉÄ„Éã": "üï∑Ô∏è", "„Éê„ÉÉ„Çø": "ü¶ó", "„Ç≥„Ç™„É≠„ÇÆ": "ü¶ó", "„Çπ„Ç∫„É†„Ç∑": "ü¶ó", "„Çª„Éü": "ü¶ó", "„Éõ„Çø„É´": "üî¶", "„Ç¢„É°„É≥„Éú": "ü¶ü", "„Ç≤„É≥„Ç¥„É≠„Ç¶": "ü™≤", "„Çø„Ç¨„É°": "ü™≤", "„Éü„Ç∫„Ç´„Éû„Ç≠„É™": "ü¶ó", "„Çæ„Ç¶„É™„É†„Ç∑": "ü¶†", "„Éü„Ç∏„É≥„Ç≥": "ü¶†", "„Ç¢„É°„Éº„Éê": "ü¶†", "„Éó„É©„Éä„É™„Ç¢": "ü™±", "„ÇØ„É™„Ç™„Éç": "üßö", "„ÇØ„É©„Ç≤": "ü™º", "„Éí„Éà„Éá": "‚≠ê", "„Ç¶„Éã": "ü¶î", "„Éä„Éû„Ç≥": "ü•í", "„Éï„Ç∞": "üê°", "„Ç§„ÉØ„Ç∑": "üêü", "„Ç¢„Ç∏": "üêü", "„Çµ„Éê": "üêü", "„Çµ„É≥„Éû": "üêü", "„Çø„Ç§": "üêü", "„Éû„Ç∞„É≠": "üêü", "„Çµ„Ç±": "üêü", "„É©„Éº„ÉÜ„É´": "ü¶°", "„ÇØ„Ç∫„É™": "ü¶°", "„Çø„Çπ„Éû„Éã„Ç¢„Éá„Éì„É´": "üëø", "„Éû„É≥„Éâ„É™„É´": "üêí"
        };

        const getEmoji = (name) => {
            for (const [key, emoji] of Object.entries(ANIMAL_EMOJIS)) {
                if (name.includes(key)) return emoji;
            }
            return "üêæ";
        };

        const CARD_DATA_RAW = {
            GOD: ["Ââµ‰∏ñ„ÅÆ„Éõ„ÉØ„Ç§„Éà„É©„Ç§„Ç™„É≥","ÁµÇÁÑâ„ÅÆ„Éñ„É©„ÉÉ„ÇØ„Éâ„É©„Ç¥„É≥","ÊôÇÁ©∫„ÅÆ„ÇØ„Ç∏„É©„Éª„Ç≥„Çπ„É¢„Ç™„Éº„Ç∑„É£„É≥","Ê¨°ÂÖÉ„ÅÆ‰∫Ä„Éª„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Çø„Éº„Éà„É´","Â§™ÈôΩÁ•û„É©„Éº„Éª„Éï„Ç°„É´„Ç≥„É≥"],
            LEGEND: ["„Ç¥„Éº„É´„Éá„É≥„Éª„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ","Ê∑±Êµ∑Áéã„ÇØ„É©„Éº„Ç±„É≥","Èõ∑Â∏ù„Ç∞„É™„Éï„Ç©„É≥","ÈãºÈâÑ„ÅÆ„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ","Ê•µÂåó„ÅÆÂπªÁç£„Éû„É≥„É¢„Çπ","ÁÅºÁÜ±„ÅÆ„Çµ„É©„Éû„É≥„ÉÄ„Éº","Êö¥È¢®„ÅÆ„Éö„Ç¨„Çµ„Çπ","ÁåõÊØí„ÅÆ„Ç≠„É≥„Ç∞„Éí„Éâ„É©","ÈúäÂ≥∞„ÅÆ‰πùÂ∞æ„ÅÆÁãê","Ë≥¢ËÄÖ„Çπ„Éï„Ç£„É≥„ÇØ„Çπ","Êµ∑Áéã„É™„É¥„Ç°„Ç§„Ç¢„Çµ„É≥","ÂÜ•Áïå„ÅÆÁï™Áä¨„Ç±„É´„Éô„É≠„Çπ","ÂåóÊ¨ß„ÅÆÂ∑®Áãº„Éï„Çß„É≥„É™„É´","ËÅñÁç£„É¶„Éã„Ç≥„Éº„É≥","Â§ßÊÄ™È≥•„É≠„ÉÉ„ÇØ"],
            ULTIMATE: ["„Ç≠„É≥„Ç∞„Ç≥„É≥„Ç∞„Éª„Ç¥„É™„É©","„É°„Ç¨„É≠„Éâ„É≥","ÁöáÂ∏ù„Éö„É≥„ÇÆ„É≥„Éª„Ç∏„Çß„Éç„É©„É´","„Ç¢„Éº„Éû„Éº„Éâ„Éª„Çµ„Ç§","Ââ£Ë±™„Ç´„Éû„Ç≠„É™","„Éá„Çπ„Éª„Çπ„Ç≥„Éº„Éî„Ç™„É≥","„Éû„ÉÉ„Éè„Éª„Éè„É§„Éñ„Çµ","„Ç∏„É£„Ç§„Ç¢„É≥„Éà„Éª„Ç¢„Éä„Ç≥„É≥„ÉÄ","„Éô„É≥„Ç¨„É´„Éª„Çø„Ç§„Ç¨„ÉºÔºàË¶öÈÜíÔºâ","„Ç∞„É¨„Éº„Éà„Éª„Éõ„ÉØ„Ç§„Éà„Éª„Éô„Ç¢","„Éä„Ç§„É´„Éª„ÇØ„É≠„Ç≥„ÉÄ„Ç§„É´ÔºàÁãÇÊö¥ÂåñÔºâ","„Ç®„É¨„ÇØ„Éà„É≠„Éª„Ç§„Éº„É´","„Éù„Ç§„Ç∫„É≥„Éª„ÉÄ„Éº„Éà„Éï„É≠„ÉÉ„Ç∞","„Ç´„Éñ„Éà„É†„Ç∑„Éª„Éò„É©„ÇØ„É¨„Çπ","‰æç„Ç§„Éº„Ç∞„É´","ÂøçËÄÖ„É†„Çµ„Çµ„Éì","ÂπªÊÉë„ÅÆ„Ç´„É°„É¨„Ç™„É≥","ÈâÑÂ£Å„ÅÆ„Ç¢„É´„Éû„Ç∏„É≠","Âê∏Ë°Ä„Ç≥„Ç¶„É¢„É™„Éª„É≠„Éº„Éâ","Â≠§È´ò„ÅÆ„Ç™„Ç™„Ç´„Éü„Éª„É™„Éº„ÉÄ„Éº","„Éà„É™„Ç±„É©„Éà„Éó„Çπ„Éª„ÉÅ„É£„Éº„Ç∏„É£„Éº","„Çπ„Éî„Éé„Çµ„Ç¶„É´„Çπ„Éª„Ç¢„ÇØ„Ç¢","„Éó„ÉÜ„É©„Éé„Éâ„É≥„Éª„Çπ„Ç´„Ç§","„Çµ„Éº„Éô„É´„Çø„Ç§„Ç¨„Éº","„ÇÆ„Ç¨„É≥„Éà„Éî„ÉÜ„ÇØ„Çπ","„É¢„Çµ„Çµ„Ç¶„É´„Çπ","„ÉÄ„É≥„ÇØ„É´„Ç™„Çπ„ÉÜ„Ç¶„Çπ","„Ç¢„Éé„Éû„É≠„Ç´„É™„Çπ„Éª„Ç™„É°„Ç¨","„Éñ„É©„Ç≠„Ç™„Çµ„Ç¶„É´„Çπ„Éª„Çø„Ç§„Çø„É≥","„É¥„Çß„É≠„Ç≠„É©„Éó„Éà„É´„Éª„Ç¢„Çµ„Ç∑„É≥","„Éë„Ç≠„Ç±„Éï„Ç°„É≠„Çµ„Ç¶„É´„Çπ„Éª„Éè„É≥„Éû„Éº","„Ç¢„É≥„Ç≠„É≠„Çµ„Ç¶„É´„Çπ„Éª„Çø„É≥„ÇØ","„Çπ„ÉÜ„Ç¥„Çµ„Ç¶„É´„Çπ„Éª„Éñ„É¨„Éº„Éâ","„Ç¢„É´„Ç≤„É≥„Çø„É¥„Ç£„Çπ","„Ç±„ÉÑ„Ç°„É´„Ç≥„Ç¢„Éà„É´„Çπ","„ÉÜ„Ç£„Çø„Éé„Éú„Ç¢","„ÉÄ„Ç§„Ç¢„Ç¶„É´„Éï","„É°„Ç¨„ÉÜ„É™„Ç¶„É†","„ÇÆ„Ç¨„Éé„Éà„Çµ„Ç¶„É´„Çπ","„É™„Ç™„Éó„É¨„Ç¶„É≠„Éâ„É≥","„Éó„É¨„Ç∑„Ç™„Çµ„Ç¶„É´„Çπ","„Ç§„ÇØ„ÉÅ„Ç™„Çµ„Ç¶„É´„Çπ","„Éá„Ç£„É°„Éà„É≠„Éâ„É≥","„Éë„É©„Çµ„Ç¶„É≠„É≠„Éï„Çπ","ÂßãÁ•ñÈ≥•„Ç¢„É´„Ç±„Ç™„Éó„ÉÜ„É™„ÇØ„Çπ"],
            EPIC: ["„Ç¢„Éï„É™„Ç´„Çæ„Ç¶","„É©„Ç§„Ç™„É≥","„ÉÅ„Éº„Çø„Éº","„Éí„Éß„Ç¶","„Ç∏„É£„Ç¨„Éº","„Ç´„Éê","„Ç≠„É™„É≥","„Éê„ÉÉ„Éï„Ç°„É≠„Éº","„Ç§„Éé„Ç∑„Ç∑","ÈóòÁâõ","„Ç´„É≥„Ç¨„É´„Éº","„Ç≥„É¢„Éâ„Éâ„É©„Ç¥„É≥","„Ç™„Ç™„Éà„Ç´„Ç≤","„ÉØ„Éã„Ç¨„É°","„Éã„Ç∑„Ç≠„Éò„Éì","„Ç≠„É≥„Ç∞„Ç≥„Éñ„É©","„Ç¨„É©„Ç¨„É©„Éò„Éì","„Ç™„Ç™„ÉØ„Ç∑","„Ç≥„É≥„Éâ„É´","„Éï„ÇØ„É≠„Ç¶","„ÉÄ„ÉÅ„Éß„Ç¶","„Éí„ÇØ„Ç§„Éâ„É™","„Éõ„Éõ„Ç∏„É≠„Ç∂„É°","„Ç∑„É£„ÉÅ","„Ç∑„É•„É¢„ÇØ„Ç∂„É°","„ÉÄ„Ç§„Ç™„Ç¶„Ç§„Ç´","„Ç®„Ç§","„Éî„É©„Éã„Ç¢Áæ§","„Ç™„Ç™„Çπ„Ç∫„É°„Éê„ÉÅ","„ÇÆ„É©„Éï„Ç°„Éé„Ç≥„ÇÆ„É™„ÇØ„ÉØ„Ç¨„Çø","„Ç™„Éã„É§„É≥„Éû","„Çø„É©„É≥„ÉÅ„É•„É©","„É†„Ç´„Éá","„Ç∞„É™„Ç∫„É™„Éº","„Éë„É≥„ÉÄ","„Éû„É≥„Éâ„É™„É´","„Ç™„É©„É≥„Ç¶„Éº„Çø„É≥","„É©„Éº„ÉÜ„É´","„ÇØ„Ç∫„É™","„Çø„Çπ„Éû„Éã„Ç¢„Éá„Éì„É´","„Éò„É©„Ç∏„Ç´","„Ç∏„É£„Ç≥„Ç¶„Ç¶„Ç∑","„É¶„Ç≠„Éí„Éß„Ç¶","„ÇØ„É≠„Éí„Éß„Ç¶","„Éû„É¨„Éº„Ç∞„Éû","„ÉÑ„Ç≠„Éé„ÉØ„Ç∞„Éû","„Éõ„ÉÉ„Ç≠„Éß„ÇØ„Ç™„Ç™„Ç´„Éü","„É™„Ç´„Ç™„É≥","„Éñ„ÉÅ„Éè„Ç§„Ç®„Éä","„Ç∑„Éû„Éè„Ç§„Ç®„Éä","„Ç¢„É™„ÇØ„Ç§","„Ç™„Ç™„Ç¢„É™„ÇØ„Ç§","„Éü„Éº„Ç¢„Ç≠„É£„ÉÉ„ÉàÈÉ®Èöä","„Éû„É≥„Ç∞„Éº„Çπ","„Éè„Éñ","„Éñ„É©„ÉÉ„ÇØ„Éû„É≥„Éê","„Ç∞„É™„Éº„É≥„Ç§„Ç∞„Ç¢„Éä","„Éü„Ç∫„Ç™„Ç™„Éà„Ç´„Ç≤","„Ç®„É™„Éû„Ç≠„Éà„Ç´„Ç≤","„Ç¢„Ç´„Ç¶„Éü„Ç¨„É°","„Ç™„Çµ„Ç¨„É°","„ÉØ„ÉãÔºà„Ç¨„Éì„Ç¢„É´Ôºâ","„Ç¢„É™„Ç≤„Éº„Çø„Éº„Ç¨„Éº","„Éî„É©„É´„ÇØ","„Éá„É≥„Ç≠„Éä„Éû„Ç∫","„Ç™„Ç™„Ç´„Éü„Ç¶„Ç™","„ÉÄ„É´„Éû„Ç∂„É°","„Éé„Ç≥„ÇÆ„É™„Ç∂„É°","„Éü„ÉÑ„ÇØ„É™„Ç∂„É°","„É©„Éñ„Ç´","„É™„É•„Ç¶„Ç∞„Ç¶„Éé„ÉÑ„Ç´„Ç§","„ÉÄ„Ç§„Ç™„Ç¶„Ç∞„ÇΩ„ÇØ„É†„Ç∑","„Çø„Ç´„Ç¢„Ç∑„Ç¨„Éã","„Ç™„Ç¶„É†„Ç¨„Ç§","„É°„É≥„ÉÄ„Ç≥","„Éè„Ç∑„Éì„É≠„Ç≥„Ç¶","„Éò„Éì„ÇØ„Ç§„ÉØ„Ç∑","„Ç∑„É≠„Éï„ÇØ„É≠„Ç¶","„Éü„Éü„Ç∫„ÇØ","„Ç∞„É≥„Ç´„É≥„Éâ„É™","„Ç¢„Éõ„Ç¶„Éâ„É™","„Éö„É™„Ç´„É≥","„Ç™„Ç™„Éè„Ç∑","„Çµ„Ç§„ÉÅ„Éß„Ç¶","„Ç≥„É≥„Ç¥„Ç¶„Ç§„É≥„Ç≥","„Ç¢„Éà„É©„Çπ„Ç™„Ç™„Ç´„Éñ„Éà","„Ç≥„Éº„Ç´„Çµ„Çπ„Ç™„Ç™„Ç´„Éñ„Éà","„Éò„É©„ÇØ„É¨„Çπ„Ç™„Ç™„Ç´„Éñ„Éà","„Ç¢„ÇØ„ÉÜ„Ç£„Ç™„É≥„Çæ„Ç¶„Ç´„Éñ„Éà","„Çµ„Çø„É≥„Ç™„Ç™„Ç´„Éñ„Éà"],
            RARE: ["„Ç∑„Éû„Ç¶„Éû","„Ç¨„Çº„É´","„Éå„Éº","„É©„ÇØ„ÉÄ","„Ç¢„É´„Éë„Ç´","„É©„Éû","„É≠„Éê","„É§„ÇÆ","„Éí„ÉÑ„Ç∏","„Éõ„É´„Çπ„Çø„Ç§„É≥","„Éñ„Çø","Êü¥Áä¨","„Éâ„Éº„Éô„É´„Éû„É≥","Âúü‰ΩêÁä¨","„Çª„É≥„Éà„Éê„Éº„Éä„Éº„Éâ","„Éö„É´„Ç∑„É£Áå´","‰∏âÊØõÁå´","ÈªíÁå´","„É§„Éû„Éç„Ç≥","„Ç¢„É©„Ç§„Ç∞„Éû","„Çø„Éå„Ç≠","„Ç≠„ÉÑ„Éç","„Ç§„Çø„ÉÅ","„Çπ„Ç´„É≥„ÇØ","„Éè„É™„Éç„Ç∫„Éü","„É§„Éû„Ç¢„É©„Ç∑","„É¢„Ç∞„É©","„Éì„Éº„Éê„Éº","„Ç´„Éî„Éê„É©","„Ç´„ÉØ„Ç¶„ÇΩ","„É©„ÉÉ„Ç≥","„Ç¢„Ç∂„É©„Ç∑","„Ç¢„Ç∑„Ç´","„Çª„Ç§„Ç¶„ÉÅ","„Ç∏„É•„Ç¥„É≥","„Ç§„É´„Ç´","„Éû„É≥„Éú„Ç¶","„Ç¢„É≥„Ç≥„Ç¶","„Çø„ÉÑ„Éé„Ç™„Éà„Ç∑„Ç¥","„Ç¶„Éü„Ç¨„É°","„Éö„É≥„ÇÆ„É≥","„Éï„É©„Éü„É≥„Ç¥","„ÇØ„Ç∏„É£„ÇØ","„ÉÑ„É´","ÁôΩÈ≥•","„Ç´„É¢","„Ç≠„Ç∏","„Ç≠„ÉÑ„ÉÑ„Ç≠","„Ç´„ÉØ„Çª„Éü","„ÉÑ„Éê„É°","„Éè„Éà","„Ç´„É©„Çπ","„Ç§„É≥„Ç≥","„Ç™„Ç¶„É†","„Éà„Éé„Çµ„Éû„Ç¨„Ç®„É´","„Ç¢„Éû„Ç¨„Ç®„É´","„Ç¶„Éº„Éë„Éº„É´„Éº„Éë„Éº","„Ç§„É¢„É™","„É§„É¢„É™","„É™„ÇØ„Ç¨„É°","„Ç¥„Éº„É´„Éá„É≥„É¨„Éà„É™„Éê„Éº","„É©„Éñ„É©„Éâ„Éº„É´„É¨„Éà„É™„Éê„Éº","„ÉÅ„ÉØ„ÉØ","„Éó„Éº„Éâ„É´","„ÉÄ„ÉÉ„ÇØ„Çπ„Éï„É≥„Éâ","„Éù„É°„É©„Éã„Ç¢„É≥","„É®„Éº„ÇØ„Ç∑„É£„Éº„ÉÜ„É™„Ç¢","„Ç∑„Éº„Éª„Ç∫„Éº","„Éë„Ç∞","„Éñ„É´„Éâ„ÉÉ„Ç∞","„Éï„É¨„É≥„ÉÅ„Éñ„É´„Éâ„ÉÉ„Ç∞","„Éú„Éº„ÉÄ„Éº„Ç≥„É™„Éº","„Ç∑„Çß„Éë„Éº„Éâ","„Éè„Çπ„Ç≠„Éº","ÁßãÁî∞Áä¨","„Ç≥„Éº„ÇÆ„Éº","„Éì„Éº„Ç∞„É´","„ÉÄ„É´„É°„Ç∑„Ç¢„É≥","„Ç∞„É¨„Éº„Éè„Ç¶„É≥„Éâ","„Éú„ÇØ„Çµ„ÉºÁä¨","„É≠„Ç∑„Ç¢„É≥„Éñ„É´„Éº","„Ç¢„É°„É™„Ç´„É≥„Ç∑„Éß„Éº„Éà„Éò„Ç¢","„Éû„É≥„ÉÅ„Ç´„É≥","„Çπ„Ç≥„ÉÜ„Ç£„ÉÉ„Ç∑„É•„Éï„Ç©„Éº„É´„Éâ","„É©„Ç∞„Éâ„Éº„É´","„É°„Ç§„É≥„ÇØ„Éº„É≥","„Éô„É≥„Ç¨„É´Áå´","„Çπ„Éï„Ç£„É≥„ÇØ„ÇπÁå´","„Ç∑„É£„É†Áå´","„Éé„É´„Ç¶„Çß„Éº„Ç∏„É£„É≥„Éï„Ç©„É¨„Çπ„Éà„Ç≠„É£„ÉÉ„Éà","„Éï„Çß„Éç„ÉÉ„ÇØ","„Çµ„Éº„Éê„É´„Ç≠„É£„ÉÉ„Éà","„Çπ„Éä„Éç„Ç≥","„Éû„Éå„É´„Éç„Ç≥","„Éì„É≥„Éà„É≠„É≥„Ç∞","„Éè„ÇØ„Éì„Ç∑„É≥","„ÉÜ„É≥","„Ç™„Ç≥„Ç∏„Éß","„É¢„É¢„É≥„Ç¨","„É†„Çµ„Çµ„Éì","„Éá„Ç∞„Éº","„ÉÅ„É≥„ÉÅ„É©ÔºàÂ§ßÂûãÔºâ","„Éó„É¨„Éº„É™„Éº„Éâ„ÉÉ„Ç∞","„Ç¶„Ç©„É≥„Éê„ÉÉ„Éà","„Ç≥„Ç¢„É©","„Éä„Éû„Ç±„É¢„Éé","„Ç≥„Ç¢„É™„ÇØ„Ç§","„Ç¢„É´„Éû„Ç∏„É≠ÔºàÂ∞èÂûãÔºâ","„Éê„ÇØ","„Éû„É¨„Éº„Éê„ÇØ","„Ç™„Ç´„Éî","„Éú„É≥„Ç¥","„Ç§„É≥„Éë„É©","„Ç™„É™„ÉÉ„ÇØ„Çπ","„Ç¢„Ç§„Éô„ÉÉ„ÇØ„Çπ","„Ç´„É¢„Ç∑„Ç´","„Éà„Éä„Ç´„Ç§","„Ç®„Çæ„Ç∑„Ç´","„Éã„Éõ„É≥„Ç∏„Ç´","„Ç¶„É™Âùä","„É¨„ÉÉ„Çµ„Éº„Éë„É≥„ÉÄ","„Ç≠„Éº„Ç¶„Ç£","„Ç®„Éü„É•„Éº","„É¨„Ç¢ÔºàÈ≥•Ôºâ","„Ç≥„Ç¶„Éé„Éà„É™","„Çµ„ÇÆ","„Ç¢„Ç™„Çµ„ÇÆ","„Éà„Ç≠","„É©„Ç§„ÉÅ„Éß„Ç¶","„Ç≠„É•„Ç¶„Ç´„É≥„ÉÅ„Éß„Ç¶","„Éñ„É≥„ÉÅ„Éß„Ç¶","„Ç∏„É•„Ç¶„Ç∑„Éû„ÉÑ","„Ç´„Éä„É™„Ç¢","„Ç¶„Ç∞„Ç§„Çπ","„É°„Ç∏„É≠","„Éõ„Éà„Éà„ÇÆ„Çπ","„Ç´„ÉÉ„Ç≥„Ç¶","„Ç´„É¢„É°","„Ç¶„Éü„Éç„Ç≥","„Ç®„Éà„Éî„É™„Ç´","„Éë„Éï„Ç£„É≥","„Ç¶„Éü„Çπ„Ç∫„É°","„É°„É≥„Éï„ÇØ„É≠„Ç¶","„ÉÅ„Éß„Ç¶„Ç≤„É≥„Éú„Ç¶","„Éè„É§„Éñ„ÇµÔºàÂ∞èÂûãÔºâ","„Éà„Éì","„Éü„Çµ„Ç¥","„Ç´„ÉÑ„Ç™„Éâ„É™","„Éç„ÉÉ„Ç∑„Éº","„ÉÑ„ÉÅ„Éé„Ç≥","„ÉÅ„É•„Éë„Ç´„Éñ„É©","„Éì„ÉÉ„Ç∞„Éï„ÉÉ„Éà","„É¢„Çπ„Éû„É≥","Ê≤≥Á´•","Â§©Áãó","ÈéåÈº¨","‰∫∫È≠ö","È∫íÈ∫ü","Èµ∫","ÁîåÁ©¥„ÅÆ‰∏ª"],
            COMMON: ["„Éç„Ç∫„Éü","„Éè„É†„Çπ„Çø„Éº","„É™„Çπ","„Ç¶„Çµ„ÇÆ","„É¢„É´„É¢„ÉÉ„Éà","„ÉÅ„É≥„ÉÅ„É©","„Éï„Çß„É¨„ÉÉ„Éà","„Éè„ÉÑ„Ç´„Éç„Ç∫„Éü","„Ç≥„Ç¶„É¢„É™","„Çπ„Ç∫„É°","„Éí„É®„Ç≥","„Éã„ÉØ„Éà„É™","„Ç¢„Éí„É´","ÈáëÈ≠ö","„Ç≥„Ç§","„É°„ÉÄ„Ç´","„Éâ„Ç∏„Éß„Ç¶","„Ç∂„É™„Ç¨„Éã","„Çµ„ÉØ„Ç¨„Éã","„É§„Éâ„Ç´„É™","„Ç¢„Çµ„É™","„Ç∑„Ç∏„Éü","„Ç´„Çø„ÉÑ„É†„É™","„Éä„É°„ÇØ„Ç∏","„Éü„Éü„Ç∫","„Ç¢„É™","„Ç∑„É≠„Ç¢„É™","„Ç¢„Éñ„É©„É†„Ç∑","„ÉÜ„É≥„Éà„Ç¶„É†„Ç∑","„ÉÅ„Éß„Ç¶","„Ç¨","„Éü„ÉÑ„Éê„ÉÅ","„Çπ„Ç∫„É°„Éê„ÉÅÔºàÂ∞èÂûãÔºâ","„Ç¢„Ç∑„Éä„Ç¨„Éê„ÉÅ","„Éè„Ç®","„Ç´","„Ç¥„Ç≠„Éñ„É™","„Éé„Éü","„ÉÄ„Éã","„ÇØ„É¢","„Éê„ÉÉ„Çø","„Ç≥„Ç™„É≠„ÇÆ","„Çπ„Ç∫„É†„Ç∑","„Ç´„Éû„Ç≠„É™ÔºàÂ∞èÂûãÔºâ","„Çª„Éü","„Éõ„Çø„É´","„Éà„É≥„Éú","„Ç¢„É°„É≥„Éú","„Ç≤„É≥„Ç¥„É≠„Ç¶","„Çø„Ç¨„É°","„Éü„Ç∫„Ç´„Éû„Ç≠„É™","„Çæ„Ç¶„É™„É†„Ç∑","„Éü„Ç∏„É≥„Ç≥","„Ç¢„É°„Éº„Éê","„Éó„É©„Éä„É™„Ç¢","„ÇØ„É™„Ç™„Éç","„ÇØ„É©„Ç≤","„Éí„Éà„Éá","„Ç¶„Éã","„Éä„Éû„Ç≥","„Éï„Ç∞","„Ç§„ÉØ„Ç∑","„Ç¢„Ç∏","„Çµ„Éê","„Çµ„É≥„Éû","„Çø„Ç§","„Éû„Ç∞„É≠","„Çµ„Ç±","„Çø„Ç≥","„Ç§„Ç´","„Ç™„Çø„Éû„Ç∏„É£„ÇØ„Ç∑","„Ç´„Ç®„É´ÔºàÂ∞èÂûãÔºâ","„Ç¢„Ç´„Ç¨„Ç®„É´","„Éí„Ç≠„Ç¨„Ç®„É´","„Ç¶„Ç∑„Ç¨„Ç®„É´","„Éô„É´„ÉÑ„Éé„Ç¨„Ç®„É´","„Ç´„É°„É¨„Ç™„É≥ÔºàÂ∞èÂûãÔºâ","„Ç§„Ç∞„Ç¢„ÉäÔºàÂ∞èÂûãÔºâ","„Ç´„Éä„Éò„Éì","„Éà„Ç´„Ç≤","„Éû„É†„Ç∑","„Ç¢„Ç™„ÉÄ„Ç§„Ç∑„Éß„Ç¶","„Ç∑„Éû„Éò„Éì","„É§„Éû„Ç´„Ç¨„Ç∑","„Çπ„ÉÉ„Éù„É≥","„Éü„Éâ„É™„Ç¨„É°","„ÇØ„Çµ„Ç¨„É°","„Ç§„Ç∑„Ç¨„É°","„Ç¢„Ç≤„Éè„ÉÅ„Éß„Ç¶","„É¢„É≥„Ç∑„É≠„ÉÅ„Éß„Ç¶","„Ç≠„Ç¢„Ç≤„Éè","„Ç™„Ç™„É†„É©„Çµ„Ç≠","„É¢„É´„Éï„Ç©„ÉÅ„Éß„Ç¶","„Ç´„Ç§„Ç≥","„Éü„Éé„É†„Ç∑","„Ç±„É†„Ç∑","„Ç¢„Ç™„É†„Ç∑","„Ç∑„É£„ÇØ„Éà„É™„É†„Ç∑","„Ç´„Éñ„Éà„É†„Ç∑Ôºà„É°„ÇπÔºâ","„ÇØ„ÉØ„Ç¨„ÇøÔºà„É°„ÇπÔºâ","„Éé„Ç≥„ÇÆ„É™„ÇØ„ÉØ„Ç¨„Çø","„Éü„É§„Éû„ÇØ„ÉØ„Ç¨„Çø","„Éí„É©„Çø„ÇØ„ÉØ„Ç¨„Çø","„Ç≥„ÇØ„ÉØ„Ç¨„Çø","„Ç´„Éü„Ç≠„É™„É†„Ç∑","„ÉÜ„É≥„Éà„Ç¶„É†„Ç∑ÔºàÈªíÔºâ","„Çæ„Ç¶„É†„Ç∑","„Ç≥„Ç¨„Éç„É†„Ç∑","„Ç´„Éä„Éñ„É≥","„Éï„É≥„Ç≥„É≠„Ç¨„Ç∑","„Ç™„Ç±„É©","„Éû„ÉÑ„É†„Ç∑","„Ç≠„É™„ÇÆ„É™„Çπ","„Ç¶„Éû„Ç™„Ç§","„ÇØ„ÉÑ„ÉØ„É†„Ç∑","„Ç∑„Éß„Ç¶„É™„Éß„Ç¶„Éê„ÉÉ„Çø","„Éà„Éé„Çµ„Éû„Éê„ÉÉ„Çø","„Ç§„Éä„Ç¥","„Éä„Éä„Éï„Ç∑","„Ç≥„Éé„Éè„É†„Ç∑","„Ç¢„Éñ„É©„Çº„Éü","„Éü„É≥„Éü„É≥„Çº„Éü","„ÉÑ„ÇØ„ÉÑ„ÇØ„Éú„Ç¶„Ç∑","„Éí„Ç∞„É©„Ç∑","„ÇØ„Éû„Çº„Éü","„Ç™„Éã„Ç∞„É¢","„Ç∏„Éß„É≠„Ç¶„Ç∞„É¢","„Éè„Ç®„Éà„É™„Ç∞„É¢","„Ç¢„Ç∑„ÉÄ„Ç´„Ç∞„É¢","„Çµ„ÇΩ„É™ÔºàÂ∞èÂûãÔºâ","„ÉÄ„É≥„Ç¥„É†„Ç∑","„ÉØ„É©„Ç∏„É†„Ç∑","„Éï„Éä„É†„Ç∑","„Ç™„Ç≠„Ç¢„Éü","„Éü„Ç∫„ÇØ„É©„Ç≤","„Ç®„ÉÅ„Çº„É≥„ÇØ„É©„Ç≤","„Ç¢„Ç´„ÇØ„É©„Ç≤","„Ç´„ÉÑ„Ç™„Éé„Ç®„Éú„Ç∑","„Ç§„ÇΩ„ÇÆ„É≥„ÉÅ„É£„ÇØ","„Çµ„É≥„Ç¥","„Ç¶„Éü„Ç¶„Ç∑","„Ç¢„É°„Éï„É©„Ç∑","„Çµ„Ç∂„Ç®","„Ç¢„ÉØ„Éì","„Éõ„Çø„ÉÜ","„Ç´„Ç≠","„É†„Éº„É´Ë≤ù","„Çø„Éã„Ç∑","„Ç´„ÉØ„Éã„Éä","„Éû„É™„É¢","„ÉØ„Ç´„É°","„Ç≥„É≥„Éñ","„É¢„Ç∫„ÇØ","„Éí„Ç∏„Ç≠","„ÇØ„É≠„Éû„Ç∞„É≠ÔºàÂπºÈ≠öÔºâ","„Ç´„ÉÑ„Ç™","„Éñ„É™","„Éè„Éû„ÉÅ","„Ç´„É≥„Éë„ÉÅ","„Éí„É©„É°","„Ç´„É¨„Ç§","„Ç¶„Éä„ÇÆ","„Ç¢„Éä„Ç¥","„Ç¶„ÉÑ„Éú","„Éâ„ÇØ„Çø„Éº„Éï„Ç£„ÉÉ„Ç∑„É•","„Ç∞„ÉÉ„Éî„Éº","„Éç„Ç™„É≥„ÉÜ„Éà„É©","„Ç®„É≥„Çº„É´„Éï„Ç£„ÉÉ„Ç∑„É•","„Éô„Çø","„Éá„Ç£„Çπ„Ç´„Çπ","„Ç¢„É≠„ÉØ„ÉäÔºàÂ∞èÂûãÔºâ","„Éî„É©„É´„ÇØÔºàÂπºÈ≠öÔºâ","„Ç≥„É™„Éâ„É©„Çπ","„Éó„É¨„Ç≥","„Éâ„Ç∏„Éß„Ç¶Ôºà„Ç∑„ÉûÔºâ","„ÇØ„Éû„Éé„Éü","„Éä„É≥„É®„Ç¶„Éè„ÇÆ","„ÉÅ„Éß„Ç¶„ÉÅ„Éß„Ç¶„Ç¶„Ç™","„Çπ„Ç∫„É°„ÉÄ„Ç§","„Éè„Ç≥„Éï„Ç∞","„Éè„É™„Çª„É≥„Éú„É≥","„Éà„Éì„Ç¶„Ç™","„Ç∑„Éº„É©„Ç´„É≥„ÇπÔºàÂ∞èÂûãÔºâ","„Çø„ÉÑ„Éé„Ç™„Éà„Ç∑„Ç¥ÔºàÂ∞èÂûãÔºâ","„ÇØ„É™„Ç™„ÉçÔºàÁæ§„ÇåÔºâ","„Éú„Ç¶„Éï„É©","„É§„Ç¥","„Ç¶„Ç∏","„Ç∑„É©„Éü","„Éä„É≥„Ç≠„É≥„É†„Ç∑","„Ç§„Ç®„ÉÄ„Éã","„Éû„ÉÄ„Éã","„Éí„É´","„Ç≥„Ç¶„Ç¨„Ç§„Éì„É´","„É§„Éû„Éì„É´","„Çµ„Éä„ÉÄ„É†„Ç∑","„ÇÆ„Éß„Ç¶„ÉÅ„É•„Ç¶","„Ç´„Ç§„ÉÅ„É•„Ç¶","„ÇØ„Éû„É†„Ç∑ÔºàÊúÄÂº∑Ôºâ","„Éü„Éâ„É™„É†„Ç∑"]
        };

        const ALL_CARDS = [];
        let cardIdCounter = 1;
        Object.keys(CARD_DATA_RAW).forEach(rarity => {
            CARD_DATA_RAW[rarity].forEach((name) => {
                const powerVar = Math.floor(Math.random() * 400);
                const hpVar = Math.floor(Math.random() * 800);
                ALL_CARDS.push({
                    id: cardIdCounter++,
                    name: name,
                    rarity: rarity,
                    power: RARITY_CONFIG[rarity].powerBase + powerVar,
                    hp: RARITY_CONFIG[rarity].hpBase + hpVar,
                    cost: RARITY_CONFIG[rarity].cost,
                    description: `Rank ${rarity} Beast`
                });
            });
        });

        const MISSION_POOL = [
            { id: 'm1', text: '„Éê„Éà„É´„Çí1ÂõûË°å„ÅÜ', target: 1, reward: 300, type: 'BATTLE_COUNT' },
            { id: 'm2', text: '„Çπ„Ç´„Ç¶„Éà(„Ç¨„ÉÅ„É£)„Çí1ÂõûË°å„ÅÜ', target: 1, reward: 500, type: 'GACHA_COUNT' },
            { id: 'm3', text: '„É¨„Éº„É≥„Åß„Ç´„Éº„Éâ„ÇíË≥ºÂÖ•', target: 1, reward: 100, type: 'LANE_BUY' },
            { id: 'm4', text: '„Éê„Éà„É´„ÅßÂãùÂà©„Åô„Çã', target: 1, reward: 400, type: 'BATTLE_WIN' },
            { id: 'm5', text: '„Ç´„Éº„Éâ„ÇíÂ£≤Âç¥„Åô„Çã', target: 1, reward: 200, type: 'SELL_CARD' },
            { id: 'm6', text: '„Éê„Éà„É´„Çí3ÂõûË°å„ÅÜ', target: 3, reward: 800, type: 'BATTLE_COUNT' },
        ];

        // --- UI COMPONENTS ---

        const Card = ({ card, isNew, size = "normal", showPower = true, isHidden = false, onClick, className = "", isRental = false, isSelected = false, level = 0, variantId = 1 }) => {
            if (!card) return <div className="w-24 h-36 bg-gray-800 rounded-lg animate-pulse"></div>;
            
            const variant = VARIANT_CONFIG[variantId] || VARIANT_CONFIG[1];
            const levelMultiplier = 1 + (level * 0.1);
            const displayPower = Math.floor(card.power * levelMultiplier * variant.powMod);
            const displayHp = Math.floor(card.hp * levelMultiplier * variant.hpMod);

            if (isHidden) {
                return (
                    <div className={`relative rounded-xl bg-gray-900 border-2 border-gray-700 flex flex-col items-center justify-center ${size === "small" ? "w-24 h-32 text-xs" : "w-40 h-56 text-xl"} shadow-xl overflow-hidden ${className}`}>
                        <div className="text-gray-700 font-bold">?</div>
                        <div className="text-gray-600 text-[10px] mt-1">UNKNOWN</div>
                    </div>
                );
            }

            const config = RARITY_CONFIG[card.rarity];
            const isHolo = card.rarity === 'GOD' || card.rarity === 'LEGEND' || variantId === 2 || variantId === 10;
            const bgGradient = `bg-gradient-to-br ${config.color}`;
            const dimClass = size === "small" ? "w-24 h-32 text-[10px]" : "w-40 h-56";
            const titleSize = size === "small" ? "text-[10px]" : "text-xs";
            const emojiSize = size === "small" ? "text-4xl" : "text-6xl";
            const emoji = useMemo(() => getEmoji(card.name), [card.name]);
            
            const variantRing = variant.colorClass;
            const displayName = card.name + (variant.id !== 1 ? ` ${variant.suffix}` : "");

            return (
                <div onClick={onClick} className={`relative rounded-xl p-0.5 transition-all duration-300 transform ${onClick ? 'cursor-pointer active:scale-95' : ''} ${variantRing} ${bgGradient} shadow-lg ${className} ${isSelected ? "ring-4 ring-green-500" : ""}`}>
                    <div className={`h-full w-full bg-gray-900 rounded-lg overflow-hidden flex flex-col relative ${dimClass}`}>
                        <div className="absolute inset-0 bg-gray-800 opacity-50" style={{backgroundImage: 'radial-gradient(#ffffff10 1px, transparent 1px)', backgroundSize: '10px 10px'}}></div>
                        {isHolo && <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent animate-[shimmer_3s_infinite] pointer-events-none" style={{backgroundSize: '200% 100%'}} />}
                        <div className="absolute top-0 left-0 z-10 flex justify-between items-center p-1 w-full">
                            <span className={`font-black ${config.text} drop-shadow-md px-1 bg-black/40 rounded`}>{card.rarity.substring(0,1)}</span>
                            <span className="text-white/90 font-mono bg-black/50 px-1 rounded text-[10px]">Lv.{level+1}</span>
                        </div>
                        <div className={`flex-1 flex items-center justify-center z-10 ${emojiSize} filter drop-shadow-lg ${variant.id===6?'grayscale opacity-70':''}`}>{emoji}</div>
                        <div className="relative z-10 w-full p-1.5 text-center bg-gradient-to-t from-black/90 to-transparent">
                            <h3 className={`${titleSize} font-bold text-white mb-1 leading-tight line-clamp-2 min-h-[2.4em] flex items-center justify-center drop-shadow-md ${variant.id === 2 ? 'variant-text-secret' : ''}`}>{displayName}</h3>
                            {showPower && <div className="flex justify-between gap-1 text-[9px] font-mono text-white bg-black/60 rounded px-1 py-0.5 backdrop-blur-sm border border-white/10"><span className="text-green-400">H{displayHp}</span><span className="text-red-400">A{displayPower}</span></div>}
                        </div>
                        {isNew && <div className="absolute top-3 -right-8 bg-red-600 text-white text-[8px] font-bold px-8 py-0.5 rotate-45 shadow-lg z-20">NEW</div>}
                        {isRental && <div className="absolute top-3 -left-8 bg-blue-600 text-white text-[8px] font-bold px-8 py-0.5 -rotate-45 shadow-lg z-20">RENTAL</div>}
                        {isSelected && <div className="absolute inset-0 bg-green-500/30 z-30 flex items-center justify-center"><Icons.CheckCircle size={32} className="text-white drop-shadow-lg"/></div>}
                    </div>
                </div>
            );
        };

        const Button = ({ children, onClick, variant = "primary", disabled = false, className = "", size="normal" }) => {
            const baseStyle = "rounded-lg font-bold transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:grayscale";
            const sizeStyles = size === "small" ? "px-2 py-1 text-xs" : "px-4 py-3 text-sm md:text-base";
            const variants = {
                primary: "bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white shadow-lg shadow-blue-900/30",
                secondary: "bg-gray-700 hover:bg-gray-600 text-white border border-gray-600",
                gold: "bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-white shadow-lg shadow-yellow-900/30",
                danger: "bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-900/30",
                green: "bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-900/30"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${sizeStyles} ${variants[variant]} ${className}`}>{children}</button>
            );
        };

        // --- PAGINATION UTILS ---
        
        const PaginationControls = ({ page, totalPages, onPrev, onNext }) => {
            if (totalPages <= 1) return null;
            return (
                <div className="flex items-center justify-center gap-4 mt-4 bg-gray-900/80 p-2 rounded-full backdrop-blur-sm shadow-lg">
                    <Button onClick={onPrev} disabled={page === 0} size="small" variant="secondary"><Icons.ChevronLeft size={16}/></Button>
                    <span className="font-mono text-sm">{page + 1} / {totalPages}</span>
                    <Button onClick={onNext} disabled={page >= totalPages - 1} size="small" variant="secondary"><Icons.ChevronRight size={16}/></Button>
                </div>
            );
        };

        // --- ANIMATION & MODALS ---
        const PackOpener = ({ onOpen, packType }) => {
            const [cutProgress, setCutProgress] = useState(0);
            const [isCut, setIsCut] = useState(false);
            const packRef = useRef(null);
            const isDragging = useRef(false);
            const handleStart = () => { isDragging.current = true; };
            const handleMove = (e) => {
                if (!isDragging.current || isCut) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const rect = packRef.current.getBoundingClientRect();
                const x = clientX - rect.left;
                const progress = Math.min(100, Math.max(0, (x / rect.width) * 100));
                setCutProgress(progress);
                if (progress > 85) { setIsCut(true); setTimeout(onOpen, 600); }
            };
            const handleEnd = () => { isDragging.current = false; if (!isCut) setCutProgress(0); };
            
            // „Éë„ÉÉ„ÇØ„Çø„Ç§„Éó„Åî„Å®„ÅÆ„Çπ„Çø„Ç§„É´
            const currentPack = PACK_TYPES.find(p => p.id === packType) || PACK_TYPES[0];
            const packColor = currentPack.color.split(' ')[0].replace('from-', 'bg-') || 'bg-yellow-600';

            return (
                <div className="flex flex-col items-center justify-center h-full w-full animate-in fade-in zoom-in fixed inset-0 bg-black/80 z-50" style={{zIndex: 20000}}>
                   <div className={`relative w-64 h-96 bg-gradient-to-br ${currentPack.color} rounded-xl shadow-2xl border-4 ${currentPack.borderColor} flex items-center justify-center overflow-hidden select-none`}
                        ref={packRef} onMouseDown={handleStart} onMouseMove={handleMove} onMouseUp={handleEnd} onMouseLeave={handleEnd} onTouchStart={handleStart} onTouchMove={handleMove} onTouchEnd={handleEnd}>
                        <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 pointer-events-none"></div>
                        <div className="z-10 text-center pointer-events-none px-2">
                            <h2 className="text-3xl font-black text-white drop-shadow-lg italic leading-tight">{currentPack.name.replace('„Éë„ÉÉ„ÇØ', '')}<br/><span className="text-lg">PACK</span></h2>
                            <div className="mt-4 text-white/80 font-bold text-xs">SWIPE TOP ‚úÇÔ∏è</div>
                        </div>
                        <div className={`absolute top-0 left-0 w-full h-24 bg-gray-900/20 transition-transform duration-500 ${isCut ? 'translate-x-full rotate-12 opacity-0' : ''} pointer-events-none border-b-2 border-dashed border-white/50`}></div>
                        <div className="absolute top-0 left-0 w-full h-24 z-20 cursor-col-resize"><div className="absolute top-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-900 pointer-events-none transition-all duration-75" style={{ left: `${cutProgress}%`, transform: 'translate(-50%, -50%)' }}><Icons.Scissors size={20} /></div></div>
                        {isCut && <div className="absolute inset-0 bg-white animate-pulse z-50 pointer-events-none"></div>}
                   </div>
                   <p className="mt-8 text-gray-300 animate-bounce font-bold">ÁÇπÁ∑ö„Å´Ê≤ø„Å£„Å¶Âè≥„Å∏„Çπ„ÉØ„Ç§„ÉóÔºÅ</p>
                </div>
            );
        };

        const BattleTimer = ({ onComplete }) => {
            const [size, setSize] = useState(200);
            const [isActive, setIsActive] = useState(true);
            const [result, setResult] = useState(null);
            const reqRef = useRef();
            const startTime = useRef(Date.now());
            useEffect(() => {
                const animate = () => {
                    if (!isActive) return;
                    const elapsed = Date.now() - startTime.current;
                    // 1500ms -> 2000ms „Å´Â§âÊõ¥„Åó„Å¶Â∞ë„Åó„ÇÜ„Å£„Åè„Çä„Å´
                    const duration = 2000;
                    const progress = (elapsed % duration) / duration;
                    setSize(200 * (1 - progress));
                    reqRef.current = requestAnimationFrame(animate);
                };
                reqRef.current = requestAnimationFrame(animate);
                return () => cancelAnimationFrame(reqRef.current);
            }, [isActive]);
            const handleStop = () => {
                if (!isActive) return;
                setIsActive(false);
                cancelAnimationFrame(reqRef.current);
                const target = 50;
                const diff = Math.abs(size - target);
                let multiplier = 1.0, label = "MISS...", color = "text-gray-400";
                
                // Âà§ÂÆö„ÇíÁîò„ÅèË™øÊï¥
                if (diff < 20) { multiplier = 2.0; label = "PERFECT!!"; color = "text-yellow-400"; } // 15 -> 20
                else if (diff < 50) { multiplier = 1.5; label = "GREAT!"; color = "text-green-400"; } // 40 -> 50
                else if (diff < 90) { multiplier = 1.1; label = "GOOD"; color = "text-blue-400"; } // 70 -> 90
                else { multiplier = 0.8; label = "BAD..."; color = "text-red-400"; }
                
                setResult({ multiplier, label, color });
                setTimeout(() => onComplete(multiplier, label), 1000);
            };
            return (
                <div className="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-black/80 backdrop-blur-md" onTouchStart={(e)=>e.stopPropagation()} onClick={(e)=>e.stopPropagation()} onTouchEnd={handleStop} onMouseDown={handleStop}>
                    {!result ? (
                        <div className="relative w-64 h-64 flex items-center justify-center cursor-pointer">
                            <h3 className="absolute -top-16 text-white font-bold text-2xl animate-pulse text-center w-full drop-shadow-lg">TAP TO STOP!</h3>
                            <div className="absolute w-[50px] h-[50px] border-4 border-white rounded-full shadow-[0_0_20px_rgba(255,255,255,0.8)]"></div>
                            <div className="absolute border-4 border-red-500 rounded-full opacity-80 box-border" style={{ width: Math.max(0, size)+'px', height: Math.max(0, size)+'px' }}></div>
                        </div>
                    ) : (
                        <div className={`font-black ${result.color} text-5xl animate-in zoom-in duration-200 drop-shadow-2xl flex flex-col items-center`}>
                            <div>{result.label}</div>
                            <div className="text-white text-xl mt-2 font-mono">POWER x{result.multiplier}</div>
                        </div>
                    )}
                </div>
            );
        };

        const SlotMachine = ({ onResult }) => {
            const [reels, setReels] = useState([0, 0, 0]);
            const [spinning, setSpinning] = useState([true, true, true]);
            const symbols = ["üçí", "üçã", "üíé", "7Ô∏è‚É£", "üîî"];
            
            useEffect(() => {
                const interval = setInterval(() => {
                    // 80ms -> 150ms „Å´Â§âÊõ¥„Åó„Å¶ÁõÆÊäº„Åó„Åó„ÇÑ„Åô„Åè
                    setReels(prev => prev.map((val, i) => spinning[i] ? (val + 1) % symbols.length : val));
                }, 150);
                return () => clearInterval(interval);
            }, [spinning]);

            const stopReel = () => {
                const nextIndex = spinning.findIndex(Boolean);
                if (nextIndex !== -1) {
                    const newSpinning = [...spinning];
                    newSpinning[nextIndex] = false;
                    setSpinning(newSpinning);
                    // If last reel
                    if (nextIndex === 2) {
                        setTimeout(() => calculateResult(), 600);
                    }
                }
            };

            const calculateResult = () => {
                const r = reels;
                let multiplier = 0.8;
                let label = "BAD...";
                
                if (r[0] === r[1] && r[1] === r[2]) { 
                    multiplier = 2.0; label = "JACKPOT!!"; 
                } else if (r[0] === r[1] || r[1] === r[2] || r[0] === r[2]) { 
                    multiplier = 1.25; label = "LUCKY!"; 
                }
                onResult(multiplier, label);
            };

            const isFinished = spinning.every(s => !s);

            return (
                <div className="fixed inset-0 z-[100] bg-black/90 flex flex-col items-center justify-center cursor-pointer" onClick={stopReel}>
                    <h2 className="text-4xl font-black text-yellow-400 mb-8 animate-bounce">SLOT BATTLE!</h2>
                    <div className="flex gap-4 mb-8 bg-gray-800 p-6 rounded-xl border-4 border-yellow-600 shadow-2xl relative">
                        {reels.map((val, i) => (
                            <div key={i} className={`w-20 h-28 bg-white rounded border-4 ${spinning[i] ? 'border-gray-400' : 'border-red-500 scale-105 transition-transform'} flex items-center justify-center overflow-hidden`}>
                                <div className={`text-5xl ${spinning[i] ? 'reel-spinning blur-sm' : ''}`}>{symbols[val]}</div>
                            </div>
                        ))}
                        <div className="absolute -right-8 top-1/2 -translate-y-1/2 w-4 h-32 bg-red-600 rounded-full border-2 border-black"></div>
                    </div>
                    <div className="text-white text-lg animate-pulse bg-red-600 px-6 py-2 rounded-full font-bold shadow-lg">TAP TO STOP!</div>
                    <div className="mt-4 text-gray-400 text-xs text-center">
                        3 MATCH: x2.0<br/>2 MATCH: x1.25<br/>NO MATCH: x0.8
                    </div>
                </div>
            );
        };

        const TheLane = ({ onBuy, coins }) => {
            const [items, setItems] = useState([]);
            const containerRef = useRef(null);
            
            useEffect(() => {
                const spawn = () => {
                    setItems(currentItems => {
                        if (currentItems.length > 5) return currentItems;
                        
                        let rarity = 'COMMON';
                        const r = Math.random();
                        if (r < 0.005) rarity = 'LEGEND';
                        else if (r < 0.05) rarity = 'EPIC';
                        else if (r < 0.2) rarity = 'RARE';
                        
                        let variantId = 1;
                        if (Math.random() < 0.01) variantId = 2; 
                        
                        const pool = ALL_CARDS.filter(c => c.rarity === rarity);
                        const base = pool[Math.floor(Math.random() * pool.length)];
                        
                        const newItem = {
                            id: Date.now() + Math.random(),
                            card: { ...base, variantId },
                            left: 100,
                            price: Math.floor(RARITY_CONFIG[rarity].buy * (variantId === 2 ? 10 : 1.5))
                        };
                        return [...currentItems, newItem];
                    });
                };
                const interval = setInterval(spawn, 2500); 
                return () => clearInterval(interval);
            }, []); 

            useEffect(() => {
                const move = setInterval(() => {
                    setItems(prev => prev.map(i => ({ ...i, left: i.left - 0.3 })).filter(i => i.left > -30));
                }, 50);
                return () => clearInterval(move);
            }, []);

            return (
                <div className="fixed bottom-0 left-0 w-full h-24 bg-gray-950/95 border-t-2 border-yellow-600/50 z-[9000] overflow-hidden flex items-center shadow-[0_-5px_15px_rgba(0,0,0,0.5)]" ref={containerRef}>
                    <div className="absolute left-0 top-0 bg-red-600 text-white text-[10px] px-2 font-bold z-20">DARK MARKET</div>
                    {items.map(item => (
                        <div key={item.id} className="absolute top-1/2 -translate-y-1/2 w-16 cursor-pointer hover:scale-110 transition-transform z-10 flex flex-col items-center" style={{ left: `${item.left}%` }} onClick={() => onBuy(item)}>
                             <Card card={item.card} size="small" showPower={false} variantId={item.card.variantId} className="w-14 h-16 text-[8px]" />
                             <div className="bg-black text-yellow-300 text-[9px] px-1 rounded mt-1 border border-yellow-600 font-mono">{item.price}G</div>
                        </div>
                    ))}
                    <div className="absolute right-2 bottom-1 text-[10px] text-gray-500 font-mono">TAP TO BUY</div>
                </div>
            );
        };

        // --- MAIN APP ---

        function AnimalChronicle() {
            const [coins, setCoins] = useState(1000);
            const [collection, setCollection] = useState({});
            const [cardLevels, setCardLevels] = useState({});
            const [view, setView] = useState('HOME');
            const [packState, setPackState] = useState('IDLE');
            const [selectedPackId, setSelectedPackId] = useState('NORMAL');
            const [pendingPackCards, setPendingPackCards] = useState(null);
            const [battleState, setBattleState] = useState(null);
            const [isBattleTiming, setIsBattleTiming] = useState(false);
            const [isSlotBattle, setIsSlotBattle] = useState(false);
            const [damageAnim, setDamageAnim] = useState({ active: false, target: null, value: 0 });
            const [selectedDeck, setSelectedDeck] = useState([]);
            const [selectedCard, setSelectedCard] = useState(null);
            const [loginBonus, setLoginBonus] = useState(null);
            const [lastFreePackClaim, setLastFreePackClaim] = useState(0);
            const [freePackProgress, setFreePackProgress] = useState(0);
            const [timeUntilFreePack, setTimeUntilFreePack] = useState("");
            const [lastDailyReset, setLastDailyReset] = useState("");
            const [activeMissions, setActiveMissions] = useState([]);
            const [missionProgress, setMissionProgress] = useState({});
            const [claimedMissions, setClaimedMissions] = useState([]);
            const [idleRewards, setIdleRewards] = useState({ coins: 0, lastCheck: Date.now() });

            // Event
            const [currentEvent, setCurrentEvent] = useState(null);

            // Pagination State
            const [collectionPage, setCollectionPage] = useState(0);
            const [packResultPage, setPackResultPage] = useState(0);
            const [deckSelectPage, setDeckSelectPage] = useState(0);
            const [collectionSearchTerm, setCollectionSearchTerm] = useState("");
            
            const ITEMS_PER_PAGE_DECK = 10; 

            useEffect(() => {
                const saved = localStorage.getItem('animalChronicleData_v2_lux'); 
                let lastLoginDate = "";
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setCoins(parsed.coins || 1000);
                    setCollection(parsed.collection || {});
                    setCardLevels(parsed.cardLevels || {});
                    setLastFreePackClaim(parsed.lastFreePackClaim || 0);
                    setLastDailyReset(parsed.lastDailyReset || "");
                    setActiveMissions(parsed.activeMissions || []);
                    setMissionProgress(parsed.missionProgress || {});
                    setClaimedMissions(parsed.claimedMissions || []);
                    lastLoginDate = parsed.lastLoginDate || "";
                    setIdleRewards(parsed.idleRewards || { coins: 0, lastCheck: Date.now() });
                }
                const today = new Date().toLocaleDateString('ja-JP');
                if (lastLoginDate !== today) setTimeout(() => setLoginBonus(500), 1000);
                
                checkDailyReset(saved ? JSON.parse(saved).lastDailyReset : "");
                triggerRandomEvent();
                
                // Idle Calc
                const now = Date.now();
                const last = saved ? JSON.parse(saved).idleRewards?.lastCheck || now : now;
                const diffMinutes = Math.floor((now - last) / 60000);
                if (diffMinutes > 0) {
                    const earned = diffMinutes * 10; 
                    setIdleRewards(prev => ({ coins: earned, lastCheck: now }));
                    if (earned > 0) setTimeout(() => alert(`„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅÊîæÁΩÆÊé¢Á¥¢„Åß ${earned}G „ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`), 500);
                    setCoins(c => c + earned);
                }
            }, []);

            useEffect(() => {
                const today = new Date().toLocaleDateString('ja-JP');
                localStorage.setItem('animalChronicleData_v2_lux', JSON.stringify({
                    coins, collection, cardLevels, lastFreePackClaim, lastDailyReset, activeMissions, missionProgress, claimedMissions, lastLoginDate: today, idleRewards: { ...idleRewards, lastCheck: Date.now() }
                }));
            }, [coins, collection, cardLevels, lastFreePackClaim, lastDailyReset, activeMissions, missionProgress, claimedMissions]);

            useEffect(() => {
                const interval = setInterval(() => {
                    const now = Date.now();
                    const msSinceClaim = now - lastFreePackClaim;
                    const msCooldown = 24 * 60 * 60 * 1000;
                    if (msSinceClaim >= msCooldown) { setFreePackProgress(100); setTimeUntilFreePack("READY"); }
                    else {
                        setFreePackProgress(Math.min(100, Math.max(0, (msSinceClaim / msCooldown) * 100)));
                        const h = Math.floor((msCooldown - msSinceClaim) / (1000 * 60 * 60));
                        const m = Math.floor(((msCooldown - msSinceClaim) % (1000 * 60 * 60)) / (1000 * 60));
                        setTimeUntilFreePack(`${h}:${m.toString().padStart(2,'0')}`);
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [lastFreePackClaim]);

            const filteredCollectionCards = useMemo(() => {
                const allMyCards = [];
                Object.keys(collection).forEach(key => {
                    if (collection[key] > 0) {
                        const [id, varId] = key.split('_').map(Number);
                        const base = ALL_CARDS.find(c => c.id === id);
                        if (base) allMyCards.push({ ...base, variantId: varId });
                    }
                });

                const filtered = allMyCards.filter(c => 
                    c.name.includes(collectionSearchTerm)
                );

                return filtered.sort((a, b) => {
                    const aOwned = collection[`${a.id}_${a.variantId}`] ? 1 : 0;
                    const bOwned = collection[`${b.id}_${b.variantId}`] ? 1 : 0;
                    if (aOwned !== bOwned) return bOwned - aOwned;
                    if (a.rarity !== b.rarity) return RARITY_CONFIG[b.rarity].powerBase - RARITY_CONFIG[a.rarity].powerBase;
                    return a.id - b.id;
                });
            }, [collection, collectionSearchTerm]);

            const checkDailyReset = (currentLastResetDate) => {
                const today = new Date().toLocaleDateString('ja-JP');
                if (today !== currentLastResetDate) {
                    const shuffled = [...MISSION_POOL].sort(() => 0.5 - Math.random());
                    setActiveMissions(shuffled.slice(0, 3));
                    setMissionProgress({});
                    setClaimedMissions([]);
                    setLastDailyReset(today);
                    triggerRandomEvent();
                }
            };

            const triggerRandomEvent = () => {
                // Lower probability for events as requested
                const rand = Math.random();
                if (rand < 0.05) setCurrentEvent({ title: "üî• Ê∫∂Â≤©ÊµÅÁô∫Áîü‰∏≠ÔºÅ", description: "LAVAÂ±ûÊÄßÂá∫ÁèæÁéáÂ§ßÂπÖUPÔºÅ", type: "LAVA" });
                else if (rand < 0.10) setCurrentEvent({ title: "üíé „ÇØ„É™„Çπ„Çø„É´Êé°ÊéòÁ•≠", description: "CRYSTALÂ±ûÊÄßÂá∫ÁèæÁéáÂ§ßÂπÖUPÔºÅ", type: "CRYSTAL" });
                else if (rand < 0.12) setCurrentEvent({ title: "üëë Áéã„ÅÆÂ∏∞ÈÇÑ", description: "LEGENDÊéíÂá∫ÁéáÂ§ßÂπÖUPÔºÅ", type: "LEGEND" });
                else if (rand < 0.15) setCurrentEvent({ title: "ü§ñ Ê©üÊ¢∞Âåñ„ÅÆÊ≥¢", description: "MECHAÂ±ûÊÄßÂá∫ÁèæÁéáÂ§ßÂπÖUPÔºÅ", type: "MECHA" });
                else setCurrentEvent(null);
            };

            const updateMission = (type, amount = 1) => {
                const newProgress = { ...missionProgress };
                let updated = false;
                activeMissions.forEach(m => {
                    if (m.type === type) {
                        const current = newProgress[m.id] || 0;
                        if (current < m.target) {
                            newProgress[m.id] = current + amount;
                            updated = true;
                        }
                    }
                });
                if (updated) setMissionProgress(newProgress);
            };

            const rollRarity = (packType) => {
                const config = PACK_TYPES.find(p => p.id === packType);
                
                // minRarity„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÊäΩÈÅ∏„ÉÜ„Éº„Éñ„É´„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„Å¶ÂÜçË®àÁÆó
                let availableRarities = ['GOD', 'LEGEND', 'ULTIMATE', 'EPIC', 'RARE', 'COMMON'];
                if (config && config.minRarity) {
                    const minIdx = availableRarities.indexOf(config.minRarity);
                    if (minIdx !== -1) {
                        availableRarities = availableRarities.slice(0, minIdx + 1);
                    }
                }

                // Á¢∫Áéá„ÅÆÈáç„ÅøË®àÁÆó
                let totalWeight = 0;
                const weights = {};

                for (let key of availableRarities) {
                    let prob = RARITY_CONFIG[key].probability;
                    
                    // „Ç§„Éô„É≥„ÉàË£úÊ≠£
                    if (currentEvent && currentEvent.type === key) prob *= 1.5;
                    
                    // „Éë„ÉÉ„ÇØË£úÊ≠£(GOD)
                    if (key === 'GOD' && config && config.godMult) {
                        prob *= config.godMult;
                    }
                    
                    weights[key] = prob;
                    totalWeight += prob;
                }

                const r = Math.random() * totalWeight;
                let cumulative = 0;
                for (let key of availableRarities) {
                    cumulative += weights[key];
                    if (r < cumulative) return key;
                }
                
                return availableRarities[availableRarities.length - 1];
            };
            
            const rollVariant = (packType) => {
                const config = PACK_TYPES.find(p => p.id === packType);

                // „Éë„ÉÉ„ÇØÂõ∫Êúâ„ÅÆVariantÁ¢∫Áéá„Åå„ÅÇ„ÇãÂ†¥Âêà (50%Âõ∫ÂÆö„Å™„Å©)
                if (config && config.variantRate) {
                    for (const [vId, rate] of Object.entries(config.variantRate)) {
                        if (Math.random() < rate) return parseInt(vId);
                    }
                }

                if (currentEvent) {
                    const eventVariantEntry = Object.values(VARIANT_CONFIG).find(v => v.name === currentEvent.type);
                    if (eventVariantEntry) {
                        if (Math.random() < 0.80) return eventVariantEntry.id;
                    }
                }

                const r = Math.random();
                for (let id = 2; id <= 10; id++) {
                      let chance = VARIANT_CONFIG[id].chance;
                      
                      // „Éë„ÉÉ„ÇØ„Å´„Çà„ÇãSecretÁ¢∫ÁéáË£úÊ≠£
                      if (id === 2 && config && config.secretMult) {
                          chance *= config.secretMult;
                      }

                      if (Math.random() < chance) return id;
                }
                return 1; 
            };

            const getRandomCard = (packType = 'NORMAL') => {
                let rarity = rollRarity(packType);
                const pool = ALL_CARDS.filter(c => c.rarity === rarity);
                const base = pool[Math.floor(Math.random() * pool.length)];
                const variant = rollVariant(packType);
                return { ...base, variantId: variant };
            };
            
            const openPack = (count = 1, isFree = false) => {
                const config = PACK_TYPES.find(p => p.id === selectedPackId);
                
                if (isFree) {
                    if (freePackProgress < 100) return;
                    setLastFreePackClaim(Date.now());
                    setFreePackProgress(0);
                    // Free is always NORMAL pack logic
                } else {
                    const cost = count * config.price;
                    if (coins < cost) return;
                    setCoins(prev => prev - cost);
                }
                
                const newCards = [];
                const draws = isFree ? 5 : count * 5;
                const packTypeForDraw = isFree ? 'NORMAL' : selectedPackId;

                for (let i = 0; i < draws; i++) {
                    newCards.push(getRandomCard(packTypeForDraw));
                }
                setPendingPackCards(newCards);
                setPackResultPage(0);
                setPackState('SHOW_PACK');
            };

            const finishPackOpening = () => {
                const newColl = { ...collection };
                pendingPackCards.forEach(c => { 
                    const key = `${c.id}_${c.variantId}`;
                    newColl[key] = (newColl[key] || 0) + 1; 
                });
                setCollection(newColl);
                setPackState('SHOW_RESULTS');
                updateMission('GACHA_COUNT');
            };

            const handleLaneBuy = (item) => {
                if (coins < item.price) { alert("„ÅäÈáë„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ"); return; }
                if (!window.confirm(`${item.card.name} „Çí ${item.price}G „ÅßË≥ºÂÖ•„Åó„Åæ„Åô„ÅãÔºü`)) return;
                setCoins(prev => prev - item.price);
                const key = `${item.card.id}_${item.card.variantId}`;
                setCollection(prev => ({ ...prev, [key]: (prev[key] || 0) + 1 }));
                updateMission('LANE_BUY');
                alert("Ë≥ºÂÖ•„Åó„Åæ„Åó„ÅüÔºÅ");
            };

            const startRankBattle = () => { confirmDeckAndStart(true); };
            const startNormalBattle = () => { confirmDeckAndStart(false); };

            const confirmDeckAndStart = (isRank) => {
                if (selectedDeck.length !== 3) { alert("„Ç´„Éº„Éâ„Çí3ÊûöÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑÔºÅ"); return; }
                const myTeam = selectedDeck.map(c => {
                    const level = cardLevels[c.id] || 0;
                    const variant = VARIANT_CONFIG[c.variantId];
                    const mult = 1 + (level * 0.1);
                    return { 
                        ...c, 
                        hp: Math.floor(c.hp * mult * variant.hpMod), 
                        power: Math.floor(c.power * mult * variant.powMod),
                        currentHp: Math.floor(c.hp * mult * variant.hpMod), 
                        level: level, 
                        isRental: c.isRental || false 
                    };
                });
                
                const playerTotalPower = myTeam.reduce((sum, c) => sum + c.power, 0);
                const playerAvgPower = playerTotalPower / 3;

                const enemyTeam = [];
                for(let i=0; i<3; i++) {
                    const base = ALL_CARDS[Math.floor(Math.random() * ALL_CARDS.length)];
                    const variantId = rollVariant(); 
                    const variant = VARIANT_CONFIG[variantId];
                    const enemyLevel = Math.max(0, Math.floor((playerAvgPower - base.power)/1000));
                    const mult = 1 + (enemyLevel * 0.1);
                    
                    // ÈÄöÂ∏∏„Éê„Éà„É´„ÅÆÊïµ„ÇíÂº±‰ΩìÂåñ („Çπ„ÉÜ„Éº„Çø„Çπ 0.7ÂÄç)
                    const normalBattleNerf = 0.7;

                    enemyTeam.push({ 
                        ...base, 
                        variantId, 
                        hp: Math.floor(base.hp * mult * variant.hpMod * (isRank ? 10 : normalBattleNerf)), 
                        power: Math.floor(base.power * mult * variant.powMod * (isRank ? 1 : normalBattleNerf)),
                        currentHp: Math.floor(base.hp * mult * variant.hpMod * (isRank ? 10 : normalBattleNerf)),
                        level: enemyLevel
                    });
                }

                const myMaxHp = myTeam.reduce((sum, c) => sum + c.hp, 0);
                const myTotalPower = myTeam.reduce((sum, c) => sum + c.power, 0);
                const enMaxHp = enemyTeam.reduce((sum, c) => sum + c.hp, 0);
                const enTotalPower = enemyTeam.reduce((sum, c) => sum + c.power, 0);
                
                setBattleState({ myTeam, enemyTeam, myHp: myMaxHp, myMaxHp, myPower: myTotalPower, enHp: enMaxHp, enMaxHp, enPower: enTotalPower, turn: 0, logs: [], phase: 'PLAYER_TURN', isRank: isRank });
                setView('BATTLE');
            };

            const startAttack = () => {
                if (!battleState) return;
                // 50% chance for Slot Battle
                if (Math.random() < 0.5) {
                    setIsSlotBattle(true);
                } else {
                    setIsBattleTiming(true);
                }
            };

            const resolveAttack = (multiplier, label) => {
                setIsBattleTiming(false); setIsSlotBattle(false);
                if (!battleState) return;
                const damage = Math.floor(battleState.myPower * multiplier);
                const newEnHp = Math.max(0, battleState.enHp - damage);
                setDamageAnim({ active: true, target: 'ENEMY', value: damage });
                setTimeout(() => setDamageAnim({ active: false, target: null, value: 0 }), 1000);
                const newLogs = [...battleState.logs, `Âë≥ÊñπÊîªÊíÉ: ${damage} (${label})`];
                if (newEnHp === 0) {
                    // Luxurious Rewards for Rank
                    const baseReward = battleState.isRank ? 10000 : 1000;
                    setTimeout(() => {
                        setBattleState(prev => ({ ...prev, enHp: newEnHp, finished: true, won: true, reward: baseReward, logs: [...newLogs, "WIN!"] }));
                        setCoins(prev => prev + baseReward);
                        
                        // Luxurious Drop Rate for Rank
                        const dropChance = battleState.isRank ? 0.8 : 0.5;
                        if (Math.random() < dropChance) {
                            const drop = getRandomCard();
                            const key = `${drop.id}_${drop.variantId}`;
                            setCollection(prev => ({ ...prev, [key]: (prev[key] || 0) + 1 }));
                            alert(`„Éâ„É≠„ÉÉ„ÉóÂ†±ÈÖ¨: ${drop.name} „ÇíÁç≤ÂæóÔºÅ`);
                        }
                        updateMission('BATTLE_WIN');
                    }, 1000);
                } else {
                    setBattleState(prev => ({ ...prev, enHp: newEnHp, logs: newLogs, phase: 'ENEMY_TURN' }));
                    setTimeout(executeEnemyAttack, 1500);
                }
            };

            const executeEnemyAttack = () => {
                setBattleState(prev => {
                    if (prev.finished) return prev;
                    const r = Math.random();
                    let multiplier = 1.0;
                    let label = "GOOD";
                    if (r < 0.10) { multiplier = 2.0; label = "PERFECT!!"; } 
                    else if (r < 0.40) { multiplier = 1.5; label = "GREAT!"; } 
                    else if (r < 0.90) { multiplier = 1.1; label = "GOOD"; } 
                    else { multiplier = 0.8; label = "BAD..."; }

                    const damage = Math.floor(prev.enPower * multiplier);
                    const newMyHp = Math.max(0, prev.myHp - damage);
                    const newLogs = [...prev.logs, `ÊïµÊîªÊíÉ: ${damage}„ÉÄ„É° [${label}]`];
                    if (newMyHp === 0) {
                        setCoins(c => c + 50);
                        return { ...prev, myHp: newMyHp, logs: [...newLogs, "LOSE..."], finished: true, won: false, reward: 50 };
                    } else {
                        return { ...prev, myHp: newMyHp, logs: newLogs, phase: 'PLAYER_TURN' };
                    }
                });
            };

            // --- VIEW RENDERERS ---

            const renderHome = () => (
                <div className="flex flex-col items-center justify-center h-full space-y-4 animate-in fade-in">
                    <div className="text-center space-y-1">
                        <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 filter drop-shadow-lg">ANIMAL<br/>CHRONICLE<br/><span className="text-2xl text-white">5150</span></h1>
                        <p className="text-gray-400 text-xs">ÂÖ®5150Á®Æ / ÊîæÁΩÆRPG / „É©„É≥„ÇØ„Éê„Éà„É´</p>
                        {currentEvent && <div className="mt-1 text-yellow-300 animate-pulse font-bold border border-yellow-500 bg-yellow-900/50 px-3 py-0.5 rounded-full inline-block text-xs">{currentEvent.title}</div>}
                    </div>

                    <div className="grid grid-cols-2 gap-2 w-full max-w-md px-4">
                        <Button onClick={() => setView('GACHA')} variant="gold" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Sparkles /> „Çπ„Ç´„Ç¶„Éà</div></Button>
                        <Button onClick={() => { setView('DECK_SELECT'); setSelectedDeck([]); }} variant="danger" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Zap /> „Éê„Éà„É´</div></Button>
                        <Button onClick={() => { setView('COLLECTION'); setCollectionPage(0); }} variant="primary" className="py-4 text-lg flex-col"><div className="flex items-center gap-2"><Icons.Search /> „Ç´„Éº„Éâ‰∏ÄË¶ß</div></Button>
                        
                        {/* Idle Button */}
                        <div className="bg-gray-800 rounded-lg p-2 flex flex-col items-center justify-center border border-gray-600 relative">
                            <div className="text-xs text-gray-400">ÊîæÁΩÆÂ†±ÈÖ¨</div>
                            <div className="text-yellow-400 font-bold">+{idleRewards.coins}G</div>
                            <div className="text-[10px] text-gray-500">Ëá™ÂãïÂèéÈõÜ‰∏≠...</div>
                        </div>
                    </div>
                </div>
            );

            const renderDeckSelect = () => {
                const myCards = [];
                Object.keys(collection).forEach(key => {
                    if (collection[key] > 0) {
                        const [id, varId] = key.split('_').map(Number);
                        const base = ALL_CARDS.find(c => c.id === id);
                        if (base) {
                             const vId = VARIANT_CONFIG[varId] ? varId : 1;
                             myCards.push({ ...base, variantId: vId });
                        }
                    }
                });
                
                myCards.sort((a, b) => {
                    const getPower = (c) => {
                         const variant = VARIANT_CONFIG[c.variantId] || VARIANT_CONFIG[1];
                         const level = cardLevels[c.id] || 0;
                         return Math.floor(c.power * (1 + level * 0.1) * variant.powMod);
                    };
                    return getPower(b) - getPower(a);
                });

                const totalPages = Math.ceil(myCards.length / ITEMS_PER_PAGE_DECK);
                const paginatedCards = myCards.slice(deckSelectPage * ITEMS_PER_PAGE_DECK, (deckSelectPage + 1) * ITEMS_PER_PAGE_DECK);

                 return (
                     <div className="flex flex-col h-full animate-in fade-in">
                        <div className="flex justify-between items-center mb-2 shrink-0">
                            <Button onClick={() => setView('HOME')} variant="secondary" size="small"><Icons.Home size={16}/> Êàª„Çã</Button>
                            <h2 className="text-lg font-bold text-white">Âá∫ÊíÉ„Éá„ÉÉ„Ç≠ÈÅ∏Êäû</h2>
                        </div>
                        <div className="flex justify-center gap-2 mb-4 min-h-[100px] bg-gray-800/50 p-2 rounded border border-dashed border-gray-600">
                            {selectedDeck.map((c,i) => <div key={i} onClick={() => setSelectedDeck(prev => prev.filter((_,idx)=>idx!==i))} className="relative"><Card card={c} size="small" level={cardLevels[c.id]||0} variantId={c.variantId}/></div>)}
                            {selectedDeck.length < 3 && <div className="text-gray-500 text-xs flex items-center">3‰ΩìÈÅ∏Êäû</div>}
                        </div>
                        <div className="grid grid-cols-2 gap-2 mb-4">
                             <Button onClick={startNormalBattle} variant="primary" disabled={selectedDeck.length !== 3} className="text-sm">ÈÄöÂ∏∏„Éê„Éà„É´</Button>
                             <Button onClick={startRankBattle} variant="danger" disabled={selectedDeck.length !== 3} className="text-sm flex-col leading-tight ring-2 ring-yellow-400"><span>„É©„É≥„ÇØÊà¶</span><span className="text-[10px] text-yellow-300 font-bold">(Â†±ÈÖ¨Ë∂ÖË±™ËèØ)</span></Button>
                        </div>
                        <div className="flex-1 overflow-y-auto pb-32">
                            <div className="grid grid-cols-3 gap-2">
                                {paginatedCards.map((card, idx) => {
                                    const isSelected = selectedDeck.some(c=>c.id===card.id && c.variantId===card.variantId);
                                    return (
                                        <div key={`${card.id}-${card.variantId}-${idx}`} onClick={() => { if(selectedDeck.length < 3 && !isSelected) setSelectedDeck([...selectedDeck, card]); }}>
                                            <Card card={card} size="small" isSelected={isSelected} level={cardLevels[card.id]||0} variantId={card.variantId} />
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        <div className="mb-24"><PaginationControls page={deckSelectPage} totalPages={totalPages} onPrev={()=>setDeckSelectPage(p=>Math.max(0,p-1))} onNext={()=>setDeckSelectPage(p=>Math.min(totalPages-1,p+1))} /></div>
                     </div>
                 );
            };

            const renderGacha = () => {
                const currentPack = PACK_TYPES.find(p => p.id === selectedPackId) || PACK_TYPES[0];

                return (
                 <div className="flex flex-col h-full relative p-4 bg-gray-900">
                     <div className="w-full flex justify-between items-center mb-4 shrink-0">
                        <Button onClick={() => { setView('HOME'); setPendingPackCards(null); setPackState('IDLE'); setPackResultPage(0); }} variant="secondary" size="small"><Icons.Home size={16} /> Êàª„Çã</Button>
                        <div className="flex items-center gap-2 bg-gray-800 px-3 py-1 rounded-full border border-gray-600">
                            <Icons.Coins className="text-yellow-400" size={16} />
                            <span className="font-bold text-white">{coins} G</span>
                        </div>
                     </div>

                     {packState === 'IDLE' && (
                         <div className="flex-1 flex flex-col md:flex-row gap-4 overflow-hidden animate-in fade-in">
                            {/* Left: Selected Pack & Actions */}
                            <div className="w-full md:w-1/2 flex flex-col gap-4 overflow-y-auto pb-32 no-scrollbar">
                                <div className={`min-h-[300px] md:flex-1 rounded-xl bg-gradient-to-br ${currentPack.color} border-4 ${currentPack.borderColor} flex flex-col items-center justify-center text-center p-2 relative overflow-hidden shadow-2xl shrink-0`}>
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 pointer-events-none"></div>
                                    <h2 className="text-2xl font-black text-white italic drop-shadow-md z-10">{currentPack.name.replace('„Éë„ÉÉ„ÇØ','')}</h2>
                                    <div className="text-xs font-bold text-white/80 z-10 mb-2">PACK</div>
                                    <p className="text-[10px] text-white/90 z-10 bg-black/30 px-2 py-1 rounded">{currentPack.desc}</p>
                                    <div className="mt-4 text-xl font-bold text-yellow-300 z-10 drop-shadow-md">{currentPack.price.toLocaleString()} G</div>
                                </div>
                                
                                <div className="flex flex-col gap-2 shrink-0">
                                     <Button onClick={() => openPack(1)} variant="gold" disabled={coins < currentPack.price} className="w-full py-3 text-sm">
                                         1„Éë„ÉÉ„ÇØË≥ºÂÖ•
                                     </Button>
                                     <Button onClick={() => openPack(10)} variant="gold" disabled={coins < currentPack.price * 10} className="w-full py-3 text-sm border border-white/20">
                                         10„Éë„ÉÉ„ÇØË≥ºÂÖ•
                                     </Button>
                                </div>
                                
                                {/* Free Pack Mini */}
                                <div className="bg-gray-800 p-2 rounded-lg border border-blue-500/50 flex flex-col gap-1 shrink-0">
                                    <div className="text-[10px] text-blue-300 font-bold">„Éá„Ç§„É™„ÉºÁÑ°Êñô (NORMAL)</div>
                                    <div className="w-full h-2 bg-gray-900 rounded-full overflow-hidden">
                                        <div className="h-full bg-blue-500 transition-all" style={{ width: `${freePackProgress}%` }}></div>
                                    </div>
                                    <Button onClick={() => openPack(1, true)} variant="primary" size="small" disabled={freePackProgress < 100} className="text-[10px] py-1">
                                        {freePackProgress >= 100 ? "ÁÑ°ÊñôÈñãÂ∞Å" : timeUntilFreePack}
                                    </Button>
                                </div>
                            </div>

                            {/* Right: Pack List */}
                            <div className="w-full md:w-1/2 flex flex-col gap-2 overflow-y-auto pb-32 pr-1">
                                {PACK_TYPES.map(pack => (
                                    <div 
                                        key={pack.id} 
                                        onClick={() => setSelectedPackId(pack.id)}
                                        className={`p-2 rounded-lg border-2 cursor-pointer transition-all hover:scale-105 ${selectedPackId === pack.id ? 'bg-gray-700 border-white ring-2 ring-yellow-400' : 'bg-gray-800 border-gray-600 opacity-80'}`}
                                    >
                                        <div className="font-bold text-xs truncate">{pack.name}</div>
                                        <div className="text-[10px] text-yellow-400 font-mono text-right">{pack.price.toLocaleString()} G</div>
                                    </div>
                                ))}
                            </div>
                         </div>
                     )}

                     {packState === 'SHOW_PACK' && <PackOpener onOpen={finishPackOpening} packType={selectedPackId} />}
                     
                     {packState === 'SHOW_RESULTS' && pendingPackCards && (
                         <div className="flex-1 flex flex-col w-full animate-in zoom-in">
                            <h2 className="text-center font-bold text-xl mb-4 text-yellow-400">RESULT</h2>
                            <div className="flex-1 overflow-y-auto grid grid-cols-3 gap-2 pb-32">
                                {pendingPackCards.map((c,i)=><Card key={i} card={c} isNew={collection[`${c.id}_${c.variantId}`] === 1} size="small" variantId={c.variantId}/>)}
                            </div>
                            <div className="fixed bottom-28 left-0 w-full flex justify-center z-20">
                                <Button onClick={()=>{setPackState('IDLE'); setPendingPackCards(null);}} variant="secondary" className="shadow-xl">Èñâ„Åò„Çã</Button>
                            </div>
                         </div>
                     )}
                 </div>
                );
            };

            const renderCollection = () => {
                 const cards = filteredCollectionCards.slice(collectionPage*10, (collectionPage+1)*10);
                 return (
                     <div className="flex flex-col h-full">
                         <div className="flex justify-between mb-2"><Button onClick={()=>setView('HOME')} size="small" variant="secondary"><Icons.Home size={16}/> Êàª„Çã</Button><div>Collection ({Object.values(collection).reduce((a,b)=>a+b,0)}Êûö)</div></div>
                         <div className="flex-1 overflow-y-auto grid grid-cols-2 gap-2 pb-32">{cards.map((c,i)=><div key={i} onClick={()=>setSelectedCard(c)}><Card card={c} size="small" variantId={c.variantId} level={cardLevels[c.id]||0}/><div className="text-right text-xs">x{collection[`${c.id}_${c.variantId}`]}</div></div>)}</div>
                         <div className="mb-24"><PaginationControls page={collectionPage} totalPages={Math.ceil(filteredCollectionCards.length/10)} onPrev={()=>setCollectionPage(p=>p-1)} onNext={()=>setCollectionPage(p=>p+1)} /></div>
                     </div>
                 );
            };
            
            const renderBattleView = () => {
                if (!battleState) return null;
                if (isBattleTiming) return <BattleTimer onComplete={resolveAttack} />;
                if (isSlotBattle) return <SlotMachine onResult={resolveAttack} />;
                if (battleState.finished) return (
                    <div className="flex flex-col items-center justify-center h-full space-y-6 animate-in zoom-in">
                        <h2 className={`text-5xl font-black ${battleState.won ? 'text-yellow-400' : 'text-gray-500'}`}>{battleState.won ? 'VICTORY' : 'DEFEAT'}</h2>
                        <div className="text-2xl text-white">Â†±ÈÖ¨: <span className="text-yellow-400 font-bold">+{battleState.reward} G</span></div>
                        <Button onClick={() => setView('HOME')} variant="primary" className="px-8 py-3 text-lg">„Éõ„Éº„É†„Å∏Êàª„Çã</Button>
                    </div>
                );
                return (
                    <div className="h-full flex flex-col relative overflow-hidden p-2">
                        <div className="flex justify-between text-xs font-bold mb-2">
                             <span className="text-red-400">ENEMY HP: {battleState.enHp}</span>
                             <span className="text-blue-400">YOU HP: {battleState.myHp}</span>
                        </div>
                        <div className="flex-1 flex flex-col justify-center items-center gap-8">
                             <div className="flex gap-1">{battleState.enemyTeam.map((c,i)=><div key={i} className="scale-75"><Card card={c} size="small" showPower={false} variantId={c.variantId}/></div>)}</div>
                             <div className="text-4xl font-black text-white/20">VS</div>
                             <div className="flex gap-1">{battleState.myTeam.map((c,i)=><div key={i} className="scale-90"><Card card={c} size="small" showPower={false} variantId={c.variantId}/></div>)}</div>
                        </div>
                        <div className="h-20 flex items-center justify-center pb-24">
                             {battleState.phase === 'PLAYER_TURN' && <Button onClick={startAttack} variant="danger" className="px-8 py-4 text-xl font-black shadow-lg animate-pulse">ATTACK!</Button>}
                             {battleState.phase === 'ENEMY_TURN' && <div className="text-red-400 font-bold animate-pulse">Áõ∏Êâã„ÅÆÊîªÊíÉ‰∏≠...</div>}
                        </div>
                        <div className="absolute top-1/2 left-0 w-full text-center pointer-events-none">
                            {battleState.logs.slice(-1).map((l,i) => <div key={i} className="bg-black/60 text-white inline-block px-2 rounded">{l}</div>)}
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full h-full bg-slate-900 relative shadow-2xl overflow-hidden flex flex-col font-sans">
                    <div className="absolute inset-0 z-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_50%_50%,_rgba(76,29,149,0.5),_rgba(15,23,42,1))]"></div>
                    
                    {/* Header Info */}
                    <div className="relative z-20 bg-gray-900/80 p-2 flex justify-between items-center backdrop-blur-sm border-b border-gray-700">
                        <div className="text-yellow-400 font-bold flex items-center gap-2 text-lg"><Icons.Coins /> {coins} G</div>
                        <div className="text-xs text-gray-400">Ver 2.1</div>
                    </div>

                    <div className="relative z-10 flex-1 p-4 overflow-hidden">
                        {view === 'HOME' && renderHome()}
                        {view === 'GACHA' && renderGacha()}
                        {view === 'COLLECTION' && renderCollection()}
                        {view === 'DECK_SELECT' && renderDeckSelect()}
                        {view === 'BATTLE' && renderBattleView()}
                    </div>

                    {/* Persistent Footer Lane */}
                    <TheLane onBuy={handleLaneBuy} coins={coins} />

                    {/* Modal */}
                    {selectedCard && (
                        <div className="fixed inset-0 bg-black/90 z-[9999] flex flex-col items-center justify-center p-4" onClick={() => setSelectedCard(null)}>
                             <div className="bg-gray-800 p-4 rounded-xl" onClick={e=>e.stopPropagation()}>
                                 <Card card={selectedCard} showPower={true} level={cardLevels[selectedCard.id]||0} variantId={selectedCard.variantId}/>
                                 <div className="mt-4 flex gap-2">
                                     <Button onClick={() => {
                                         const key = `${selectedCard.id}_${selectedCard.variantId}`;
                                         if(collection[key]>=2) {
                                             if(confirm("2ÊûöÊ∂àË≤ª„Åó„Å¶Ë¶öÈÜí„Åó„Åæ„Åô„ÅãÔºü")) {
                                                 setCollection(p=>({...p, [key]: p[key]-2}));
                                                 setCardLevels(p=>({...p, [selectedCard.id]: (p[selectedCard.id]||0)+1}));
                                                 setSelectedCard(null);
                                             }
                                         } else alert("„Ç´„Éº„Éâ„ÅåË∂≥„Çä„Åæ„Åõ„Çì(2ÊûöÂøÖË¶Å)");
                                     }} variant="gold" size="small">Ë¶öÈÜí(2ÊûöÊ∂àË≤ª)</Button>
                                     <Button onClick={()=>{
                                         const key = `${selectedCard.id}_${selectedCard.variantId}`;
                                         if(collection[key]>0) {
                                              if(confirm("Â£≤Âç¥„Åó„Åæ„Åô„ÅãÔºü")) {
                                                  setCollection(p=>({...p, [key]: p[key]-1}));
                                                  setCoins(c=>c+100); 
                                                  setSelectedCard(null);
                                              }
                                         }
                                     }} variant="secondary" size="small">Â£≤Âç¥</Button>
                                 </div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AnimalChronicle />);
    </script>
</body>
</html>
